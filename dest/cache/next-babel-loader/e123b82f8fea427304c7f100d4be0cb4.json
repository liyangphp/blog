{"ast":null,"code":"import _regeneratorRuntime from \"@babel/runtime-corejs2/regenerator\";\nimport _Promise from \"@babel/runtime-corejs2/core-js/promise\";\nimport _BackTop from \"antd/lib/back-top\";\nimport _Row from \"antd/lib/row\";\nimport _Affix from \"antd/lib/affix\";\nimport _Col from \"antd/lib/col\";\nimport _Button from \"antd/lib/button\";\nimport _Tag from \"antd/lib/tag\";\nimport _Icon from \"antd/lib/icon\";\nimport _Layout from \"antd/lib/layout\";\nvar __jsx = React.createElement;\nimport React, { useState, useEffect, useContext } from 'react';\nimport Head from 'next/head';\nimport servicePath from '../config/apiUrl';\nimport User from '../components/User';\nimport axios from 'axios';\nimport marked from 'marked';\nimport Router from 'next/router';\nimport hljs from \"highlight.js\";\nimport 'highlight.js/styles/monokai-sublime.css';\nimport 'markdown-navbar/dist/navbar.css';\nimport Tocify from '../components/tocify.tsx';\nimport { withRouter } from 'next/router';\nvar Content = _Layout.Content;\n\nvar Detail = function Detail(props) {\n  var _useState = useState(),\n      token = _useState[0],\n      setToken = _useState[1];\n\n  var _useState2 = useState(),\n      start = _useState2[0],\n      setStart = _useState2[1];\n\n  var _useState3 = useState(false),\n      flag = _useState3[0],\n      setFlag = _useState3[1];\n\n  var _useState4 = useState(),\n      userId = _useState4[0],\n      setUserId = _useState4[1];\n\n  var renderer = new marked.Renderer();\n  var tocify = new Tocify();\n\n  renderer.heading = function (text, level, raw) {\n    var anchor = tocify.add(text, level);\n    return \"<a id=\\\"\".concat(anchor, \"\\\" href=\\\"#\").concat(anchor, \"\\\" class=\\\"anchor-fix\\\"><h\").concat(level, \">\").concat(text, \"</h\").concat(level, \"></a>\\n\");\n  };\n\n  var editArticle = function editArticle() {\n    Router.push('/create?id=' + props.id);\n  };\n\n  var deleteArticle = function deleteArticle() {\n    console.log('asasd');\n  };\n\n  marked.setOptions({\n    renderer: renderer,\n    gfm: true,\n    pedantic: false,\n    sanitize: false,\n    tables: true,\n    breaks: false,\n    smartLists: true,\n    smartypants: false,\n    highlight: function highlight(code) {\n      return hljs.highlightAuto(code).value;\n    }\n  });\n  console.log('props', props);\n  var html = marked(props.content);\n\n  var haslike = function haslike(id) {\n    var CancelToken = axios.CancelToken;\n    var source = CancelToken.source();\n    axios({\n      method: 'get',\n      url: servicePath.hasLike + '?user_id=' + id + '&article_id=' + props.id + '&reply_id=0',\n      headers: {\n        'Authorization': 'Bearer ' + token\n      },\n      withCredentials: false,\n      cancelToken: source.token\n    }).then(function (res) {\n      source.cancel('方法被取消');\n\n      if (res.data.data.id) {\n        setFlag(true);\n      } else {\n        setFlag(false);\n      }\n    })[\"catch\"](function (error) {\n      console.log(error);\n    });\n  };\n\n  var like = function like() {\n    var dataProps = {};\n    dataProps.article_id = props.id;\n    dataProps.user_id = userId;\n    dataProps.reply_id = 0;\n    axios({\n      method: 'post',\n      url: servicePath.giveLike,\n      data: dataProps,\n      headers: {\n        'Authorization': 'Bearer ' + token\n      },\n      withCredentials: false\n    }).then(function (res) {\n      haslike(userId);\n\n      if (res.status == 204) {\n        var number = start - 1;\n        setStart(number);\n      } else {\n        var _number = start + 1;\n\n        setStart(_number);\n      }\n    })[\"catch\"](function (error) {\n      console.log('err', error); // message.error(error)\n    });\n  };\n\n  useEffect(function () {\n    console.log('flag', props.likes);\n\n    if (props.likes && props.likes.user_id == userId) {\n      setFlag(true);\n    } else {\n      setFlag(false);\n    }\n\n    setToken(localStorage.getItem('token'));\n    setUserId(localStorage.getItem('user_id'));\n  }, []);\n  return __jsx(_Layout, null, __jsx(Head, null, __jsx(\"title\", null, \"\\u535A\\u4EBA\\u5802-\", props.title)), __jsx(Content, {\n    className: \"content\"\n  }, __jsx(_Row, {\n    type: \"flex\",\n    justify: \"center\"\n  }, __jsx(_Col, {\n    xs: 24,\n    sm: 24,\n    md: 24,\n    lg: 19,\n    xl: 19\n  }, __jsx(\"div\", {\n    className: \"comm-left\"\n  }, __jsx(\"div\", {\n    className: \"detailed-title\"\n  }, props.title), __jsx(\"div\", {\n    className: \"list-icon\"\n  }, __jsx(\"span\", null, __jsx(_Icon, {\n    type: \"calendar\"\n  }), \" \", props.created_at), __jsx(\"span\", null, __jsx(_Icon, {\n    type: \"folder\"\n  }), \" \", props.category.category_name), __jsx(\"span\", null, __jsx(_Icon, {\n    type: \"fire\"\n  }), \" \", props.watches, \"\\u4EBA\")), __jsx(\"div\", {\n    className: \"detailed-content\",\n    dangerouslySetInnerHTML: {\n      __html: html\n    }\n  }), __jsx(\"div\", {\n    className: \"tags\",\n    style: {\n      display: \"flex\",\n      justifyContent: \"space-between\",\n      alignItems: \"center\",\n      padding: '10px 20px'\n    }\n  }, __jsx(\"div\", null, __jsx(_Icon, {\n    type: \"tags\",\n    theme: \"filled\",\n    style: {\n      marginRight: 12,\n      fontSize: 16\n    }\n  }), props.tags && props.tags.map(function (tag) {\n    return __jsx(_Tag, {\n      key: tag,\n      color: \"orange\"\n    }, tag);\n  })), props && props.user.id == userId && __jsx(\"div\", null, __jsx(_Button, {\n    onClick: editArticle,\n    type: \"dashed\",\n    icon: \"edit\",\n    style: {\n      textAlign: \"right\",\n      marginRight: 10\n    }\n  }, \"\\u7F16\\u8F91\"), __jsx(_Button, {\n    onClick: deleteArticle,\n    type: \"dashed\",\n    icon: \"bank\",\n    style: {\n      textAlign: \"right\"\n    }\n  }, \"\\u5220\\u9664\"))), userId && __jsx(\"div\", {\n    className: \"actions\"\n  }, flag ? __jsx(_Button, {\n    onClick: like,\n    type: \"primary\",\n    shape: \"circle\",\n    icon: \"like-o\"\n  }) : __jsx(_Button, {\n    onClick: like,\n    type: \"dashed\",\n    shape: \"circle\",\n    style: {\n      marginRight: 10\n    },\n    icon: \"like-o\"\n  })))), __jsx(_Col, {\n    xs: 0,\n    sm: 0,\n    md: 0,\n    lg: 5,\n    xl: 5\n  }, __jsx(User, {\n    user: props.user\n  }), props.category.category_name == \"教程\" && __jsx(_Affix, {\n    style: {\n      marginTop: 20\n    },\n    offsetTop: 0\n  }, __jsx(\"div\", {\n    className: \"detailed-nav comm-box1\"\n  }, __jsx(\"div\", {\n    className: \"toc-list\"\n  }, tocify && tocify.render())))))), __jsx(_BackTop, null));\n};\n\nDetail.getInitialProps = function _callee(context) {\n  var id, promise;\n  return _regeneratorRuntime.async(function _callee$(_context) {\n    while (1) {\n      switch (_context.prev = _context.next) {\n        case 0:\n          console.log('context', context);\n          id = context.ctx.query.id;\n          promise = new _Promise(function (resolve) {\n            axios(servicePath.getArticleDetail + id).then(function (res) {\n              resolve(res.data.data);\n            });\n          });\n          _context.next = 5;\n          return _regeneratorRuntime.awrap(promise);\n\n        case 5:\n          return _context.abrupt(\"return\", _context.sent);\n\n        case 6:\n        case \"end\":\n          return _context.stop();\n      }\n    }\n  });\n};\n\nexport default withRouter(Detail);","map":{"version":3,"sources":["/Users/mac/Desktop/liy-blog/pages/detail.js"],"names":["React","useState","useEffect","useContext","Head","servicePath","User","axios","marked","Router","hljs","Tocify","withRouter","Content","Detail","props","token","setToken","start","setStart","flag","setFlag","userId","setUserId","renderer","Renderer","tocify","heading","text","level","raw","anchor","add","editArticle","push","id","deleteArticle","console","log","setOptions","gfm","pedantic","sanitize","tables","breaks","smartLists","smartypants","highlight","code","highlightAuto","value","html","content","haslike","CancelToken","source","method","url","hasLike","headers","withCredentials","cancelToken","then","res","cancel","data","error","like","dataProps","article_id","user_id","reply_id","giveLike","status","number","likes","localStorage","getItem","title","created_at","category","category_name","watches","__html","display","justifyContent","alignItems","padding","marginRight","fontSize","tags","map","tag","user","textAlign","marginTop","render","getInitialProps","context","ctx","query","promise","resolve","getArticleDetail"],"mappings":"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","sourcesContent":["import React, { useState, useEffect, useContext } from 'react'\nimport Head from 'next/head'\nimport { Layout, Row, Col, Icon, Affix, BackTop, Tag, Button, message } from 'antd';\nimport servicePath from '../config/apiUrl';\nimport User from '../components/User'\nimport axios from 'axios'\nimport marked from 'marked'\nimport Router from 'next/router'\nimport hljs from \"highlight.js\";\nimport 'highlight.js/styles/monokai-sublime.css';\nimport 'markdown-navbar/dist/navbar.css';\nimport Tocify from '../components/tocify.tsx'\n\nimport { withRouter } from 'next/router'\n\n\nconst { Content } = Layout;\nconst Detail = (props) => {\n    const [token, setToken] = useState()\n    const [start, setStart] = useState()\n    const [flag, setFlag] = useState(false)\n    const [userId, setUserId] = useState()\n    const renderer = new marked.Renderer();\n    const tocify = new Tocify()\n    renderer.heading = function (text, level, raw) {\n        const anchor = tocify.add(text, level);\n        return `<a id=\"${anchor}\" href=\"#${anchor}\" class=\"anchor-fix\"><h${level}>${text}</h${level}></a>\\n`;\n    };\n\n    const editArticle = () => {\n        Router.push('/create?id=' + props.id)\n    }\n\n    const deleteArticle = () => {\n        console.log('asasd')\n    }\n\n\n    marked.setOptions({\n        renderer: renderer,\n        gfm: true,\n        pedantic: false,\n        sanitize: false,\n        tables: true,\n        breaks: false,\n        smartLists: true,\n        smartypants: false,\n        highlight: function (code) {\n            return hljs.highlightAuto(code).value;\n        }\n    });\n    console.log('props', props)\n    let html = marked(props.content)\n\n    const haslike = (id) => {\n        const CancelToken = axios.CancelToken;\n        const source = CancelToken.source();\n        axios({\n            method: 'get',\n            url: servicePath.hasLike + '?user_id=' + id + '&article_id=' + props.id + '&reply_id=0',\n            headers: {\n                'Authorization': 'Bearer ' + token,\n            },\n            withCredentials: false,\n            cancelToken: source.token,\n        }).then(\n            res => {\n                source.cancel('方法被取消');\n                if (res.data.data.id) {\n                    setFlag(true)\n                } else {\n                    setFlag(false)\n                }\n            }\n        ).catch(function (error) {\n            console.log(error)\n        });\n    };\n\n    const like = () => {\n        let dataProps = {}\n        dataProps.article_id = props.id;\n        dataProps.user_id = userId;\n        dataProps.reply_id = 0;\n        axios({\n            method: 'post',\n            url: servicePath.giveLike,\n            data: dataProps,\n            headers: {\n                'Authorization': 'Bearer ' + token,\n            },\n            withCredentials: false,\n        }).then(\n            res => {\n                haslike(userId)\n                if (res.status == 204) {\n                    let number = start - 1;\n                    setStart(number);\n                } else {\n                    let number = start + 1;\n                    setStart(number);\n                }\n\n            }\n        ).catch(function (error) {\n            console.log('err', error)\n            // message.error(error)\n        });\n    };\n\n\n\n    useEffect(() => {\n        console.log('flag',props.likes)\n        if(props.likes && props.likes.user_id == userId){\n            setFlag(true)\n        }else{\n            setFlag(false)\n        }\n        setToken(localStorage.getItem('token'))\n        setUserId(localStorage.getItem('user_id'))\n    }, [])\n\n    return (\n        <Layout>\n            <Head>\n                <title>博人堂-{props.title}</title>\n            </Head>\n\n            <Content className=\"content\">\n                <Row type=\"flex\" justify=\"center\">\n                    <Col xs={24} sm={24} md={24} lg={19} xl={19}>\n                        <div className=\"comm-left\">\n                            <div className=\"detailed-title\">\n                                {props.title}\n                            </div>\n\n                            <div className=\"list-icon\">\n                                <span><Icon type=\"calendar\" /> {props.created_at}</span>\n                                <span><Icon type=\"folder\" /> {props.category.category_name}</span>\n                                <span><Icon type=\"fire\" /> {props.watches}人</span>\n                            </div>\n\n                            <div className=\"detailed-content\"\n                                dangerouslySetInnerHTML={{ __html: html }}   >\n                            </div>\n                            <div className=\"tags\" style={{ display: \"flex\", justifyContent: \"space-between\", alignItems: \"center\", padding: '10px 20px' }}>\n                                <div>\n                                    <Icon type=\"tags\" theme=\"filled\" style={{ marginRight: 12, fontSize: 16 }} />\n                                    {\n                                        props.tags &&\n                                        props.tags.map(tag => (\n                                            <Tag key={tag} color=\"orange\">{tag}</Tag>\n                                        ))\n                                    }\n                                </div>\n\n                                {props && props.user.id == userId && <div><Button onClick={editArticle} type=\"dashed\" icon=\"edit\" style={{ textAlign: \"right\", marginRight: 10 }}>\n                                    编辑</Button>\n\n                                    <Button onClick={deleteArticle} type=\"dashed\" icon=\"bank\" style={{ textAlign: \"right\" }}>\n                                        删除</Button></div>}\n                            </div>\n                            {userId && <div className=\"actions\">\n                                {flag ? <Button onClick={like}\n                                    type=\"primary\"\n                                    shape=\"circle\"\n                                    icon=\"like-o\" /> : <Button onClick={like}\n                                        type=\"dashed\"\n                                        shape=\"circle\"\n                                        style={{ marginRight: 10 }}\n                                        icon=\"like-o\" />}\n                            </div>}\n                        </div>\n\n\n                    </Col>\n                    <Col xs={0} sm={0} md={0} lg={5} xl={5}>\n                        <User user={props.user} />\n                        {props.category.category_name == \"教程\" && <Affix style={{ marginTop: 20 }} offsetTop={0}>\n                            <div className=\"detailed-nav comm-box1\">\n                                <div className=\"toc-list\">\n                                    {tocify && tocify.render()}\n                                </div>\n                            </div>\n                        </Affix>}\n                    </Col>\n                </Row>\n            </Content>\n            <BackTop />\n\n        </Layout>\n    )\n}\n\nDetail.getInitialProps = async (context) => {\n    console.log('context', context)\n    let id = context.ctx.query.id\n    const promise = new Promise((resolve) => {\n        axios(servicePath.getArticleDetail + id).then(\n            (res) => {\n                resolve(res.data.data)\n            }\n        )\n    })\n\n    return await promise\n}\n\n\n\nexport default withRouter(Detail)"]},"metadata":{},"sourceType":"module"}