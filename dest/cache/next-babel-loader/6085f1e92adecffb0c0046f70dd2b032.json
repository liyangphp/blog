{"ast":null,"code":"import _Button from \"antd/lib/button\";\nimport _Upload from \"antd/lib/upload\";\nimport _Icon from \"antd/lib/icon\";\nimport _Avatar from \"antd/lib/avatar\";\nimport _Form from \"antd/lib/form\";\nimport _message from \"antd/lib/message\";\nimport _Input from \"antd/lib/input\";\nvar __jsx = React.createElement;\nimport React, { useState, useContext, useEffect } from 'react';\nimport axios from 'axios';\nimport { ItemContext, ParentIdContext } from './Comments';\nimport servicePath from '../config/apiUrl';\nvar TextArea = _Input.TextArea;\n\nvar Editor = function Editor(_ref) {\n  var articleId = _ref.articleId;\n\n  var _useState = useState(false),\n      submitting = _useState[0],\n      setSubmitting = _useState[1];\n\n  var _useState2 = useState(),\n      token = _useState2[0],\n      setToken = _useState2[1];\n\n  var _useState3 = useState(''),\n      value = _useState3[0],\n      setValue = _useState3[1];\n\n  var _useContext = useContext(ParentIdContext),\n      parentId = _useContext.parentId,\n      setParentId = _useContext.setParentId,\n      auth = _useContext.auth,\n      getcomments = _useContext.getcomments;\n\n  var handleChange = function handleChange(e) {\n    setValue(e.target.value);\n  };\n\n  var handleSubmit = function handleSubmit() {\n    if (!value) {\n      return;\n    }\n\n    setSubmitting(true);\n    setTimeout(function () {\n      axios({\n        method: 'post',\n        url: servicePath.getArticleDetail + articleId + '/replies',\n        headers: {\n          'Authorization': 'Bearer ' + token\n        },\n        data: {\n          parent_id: parentId,\n          rcontent: value\n        },\n        withCredentials: false\n      }).then(function (res) {\n        console.log(res);\n        setSubmitting(false);\n        setValue('');\n        setParentId(0);\n        getcomments();\n      })[\"catch\"](function (error) {\n        console.log(error);\n\n        _message.error(error.status);\n      });\n    }, 1000);\n  };\n\n  var handleUploadChange = function handleUploadChange(_ref2) {\n    var file = _ref2.file;\n    var newValue = '';\n    console.log(file);\n\n    switch (file.status) {\n      case 'done':\n        _message.destroy();\n\n        _message.success('上传成功！'); // @ts-ignore\n\n\n        newValue = value + \"![file](\".concat(file.response.file_path, \")\");\n        setValue(newValue);\n        break;\n\n      case 'error':\n        _message.destroy();\n\n        _message.error(file.response.message);\n\n        break;\n    }\n  };\n\n  useEffect(function () {\n    setToken(localStorage.getItem('token'));\n  }, []);\n  return __jsx(\"div\", {\n    className: \"editor\"\n  }, __jsx(_Form.Item, null, __jsx(TextArea, {\n    rows: 4,\n    onChange: handleChange,\n    value: value\n  })), __jsx(_Form.Item, null, __jsx(\"div\", {\n    className: \"toolbar\"\n  }, __jsx(\"div\", {\n    className: \"info\"\n  }, auth ? __jsx(\"div\", null, __jsx(_Avatar, {\n    className: \"avatar\",\n    src: auth.avatar,\n    alt: auth.name,\n    icon: \"user\"\n  }), __jsx(\"div\", {\n    style: {\n      paddingLeft: 10,\n      display: 'inline-block'\n    }\n  }, auth.name)) : __jsx(\"div\", null, \"\\u60A8\\u9700\\u8981 \", __jsx(\"a\", null, \"\\u767B\\u5F55\"), \" \\u624D\\u80FD\\u53D1\\u8868\\u8BC4\\u8BBA\")), __jsx(\"div\", {\n    className: \"actionss\"\n  }, __jsx(\"div\", {\n    className: \"action\"\n  }, __jsx(_Upload, {\n    accept: \"image/*\",\n    name: \"file\",\n    className: \"upload\",\n    action: servicePath.uploadImage,\n    showUploadList: false,\n    headers: {\n      Authorization: 'Bearer ' + token\n    },\n    onChange: handleUploadChange\n  }, __jsx(_Icon, {\n    type: \"picture\"\n  }))), __jsx(\"div\", {\n    className: \"action\"\n  }, __jsx(_Button, {\n    htmlType: \"submit\",\n    loading: submitting,\n    onClick: handleSubmit,\n    disabled: !auth,\n    type: \"primary\",\n    icon: \"message\"\n  }, \"\\u8BC4\\u8BBA\"))))));\n};\n\nexport default Editor;","map":{"version":3,"sources":["/Users/mac/Desktop/liy-blog/components/Editor.jsx"],"names":["React","useState","useContext","useEffect","axios","ItemContext","ParentIdContext","servicePath","TextArea","Editor","articleId","submitting","setSubmitting","token","setToken","value","setValue","parentId","setParentId","auth","getcomments","handleChange","e","target","handleSubmit","setTimeout","method","url","getArticleDetail","headers","data","parent_id","rcontent","withCredentials","then","res","console","log","error","status","handleUploadChange","file","newValue","destroy","success","response","file_path","message","localStorage","getItem","avatar","name","paddingLeft","display","uploadImage","Authorization"],"mappings":"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","sourcesContent":["import React, { useState, useContext, useEffect } from 'react'\nimport {Icon, Button, Upload, Avatar, Form, Input, message, Comment, Tooltip} from 'antd'\nimport axios from 'axios'\nimport {ItemContext, ParentIdContext} from './Comments'\nimport servicePath from '../config/apiUrl';\nconst { TextArea } = Input;\n\n\n\nconst Editor = ({articleId}) => {\n    const [submitting, setSubmitting] = useState(false)\n    const [token, setToken] = useState()\n    const [value, setValue] = useState('')\n    let {parentId, setParentId, auth, getcomments} = useContext(ParentIdContext)\n\n    const handleChange = e => {        \n        setValue(e.target.value)\n    };\n\n\n\n\n\n    const handleSubmit = () => {\n        if (!value) {\n            return;\n        }\n        setSubmitting(true)\n        setTimeout(() => {\n            axios({\n                method: 'post',\n                url: servicePath.getArticleDetail + articleId + '/replies',\n                headers: {\n                    'Authorization': 'Bearer ' + token,\n                },\n                data: {\n                    parent_id: parentId,\n                    rcontent: value\n                },\n                withCredentials: false,\n            }).then(\n                res => {\n                    console.log(res)\n                    setSubmitting(false)\n                    setValue('');\n                    setParentId(0)\n                    getcomments()\n                }\n            ).catch(function (error) {\n                console.log(error)\n                message.error(error.status)\n            });\n\n        }, 1000);\n    };\n\n    const handleUploadChange = ({ file }) => {\n        let newValue = '';\n        console.log(file)\n        switch (file.status) {\n            case 'done':\n                message.destroy();\n                message.success('上传成功！');\n                // @ts-ignore\n                newValue = value + `![file](${file.response.file_path})`;\n                setValue(newValue)\n                break;\n            case 'error':\n                message.destroy();\n                message.error(file.response.message);\n                break;\n        }\n    };\n\n    useEffect(() => {\n        setToken(localStorage.getItem('token'))\n    },[])\n\n\n\n    return (\n        <div className=\"editor\">\n            <Form.Item>\n                <TextArea rows={4} onChange={handleChange} value={value} />\n            </Form.Item>\n            <Form.Item>\n                <div className=\"toolbar\">\n                    <div className=\"info\">\n                        {\n                            auth ?\n                                (\n                                    <div>\n                                        <Avatar\n                                            className=\"avatar\"\n                                            src={auth.avatar}\n                                            alt={auth.name}\n                                            icon=\"user\"\n                                        />\n                                        <div style={{ paddingLeft: 10, display: 'inline-block' }}>{auth.name}</div>\n                                    </div>\n                                ) :\n                                (\n                                    <div>您需要 <a>登录</a> 才能发表评论</div>\n                                )\n                        }\n                    </div>\n                    <div className=\"actionss\">\n                        <div className=\"action\">\n                            <Upload\n                                accept=\"image/*\"\n                                name=\"file\"\n                                className=\"upload\"\n                                action= {servicePath.uploadImage}\n                                showUploadList={false}\n                                headers={{ Authorization: 'Bearer ' + token }}\n                                onChange={handleUploadChange}\n                            >\n                                <Icon type=\"picture\" />\n                            </Upload>\n                        </div>\n                        <div className=\"action\">\n                            <Button\n                                htmlType=\"submit\"\n                                loading={submitting}\n                                onClick={handleSubmit}\n                                disabled={!auth}\n                                type=\"primary\"\n                                icon=\"message\"\n                            >\n                                评论\n                        </Button>\n                        </div>\n                    </div>\n                </div>\n            </Form.Item>\n            </div>\n\n    )\n}\n\nexport default Editor"]},"metadata":{},"sourceType":"module"}