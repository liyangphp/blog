{"ast":null,"code":"import _Comment from \"antd/lib/comment\";\nimport _Icon from \"antd/lib/icon\";\nimport _message from \"antd/lib/message\";\nvar __jsx = React.createElement;\nimport React, { useState, useEffect, createContext, useMemo } from 'react';\nimport Editor from './Editor';\nimport ReactMarkdown from 'react-markdown';\nimport axios from 'axios';\nimport Star from './Star';\nimport servicePath from '../config/apiUrl';\nexport const ParentIdContext = createContext({});\nexport const ItemContext = createContext();\n\nconst Comments = ({\n  articleId\n}) => {\n  const {\n    0: token,\n    1: setToken\n  } = useState();\n  const {\n    0: parentId,\n    1: setParentId\n  } = useState(0);\n  const {\n    0: isLoading,\n    1: setIsLoading\n  } = useState(true);\n  const {\n    0: coms,\n    1: setComs\n  } = useState([]);\n  const {\n    0: auth,\n    1: setAuth\n  } = useState();\n\n  const handleCommentClick = comment => {\n    if (comment.id === parentId) {\n      setParentId(0);\n      return;\n    }\n\n    setParentId(comment.id ? comment.id : 0);\n  };\n\n  const checkLogin = token => {\n    const CancelToken = axios.CancelToken;\n    const source = CancelToken.source();\n\n    if (token != null) {\n      axios({\n        method: 'get',\n        url: servicePath.getUserInfo,\n        headers: {\n          'Authorization': 'Bearer ' + token\n        },\n        withCredentials: false,\n        cancelToken: source.token,\n        transformResponse: function (data) {\n          console.log(data);\n\n          if (data.indexOf('errors') != -1) {\n            data = JSON.parse(data);\n\n            for (var item in data.errors) {\n              _message.error(data.errors[item][0]);\n            }\n          } else if (data.indexOf('Unauthenticated') != -1) {\n            localStorage.removeItem('token');\n            return data;\n          } else {\n            return data;\n          }\n        }\n      }).then(res => {\n        source.cancel('方法被取消');\n        setIsLoading(false);\n        console.log(res);\n        res.data = eval('(' + res.data + ')');\n        console.log(res);\n        setAuth(res.data.data);\n      }).catch(function (error) {\n        console.log(error);\n      });\n    } else {\n      console.log('asasdas1');\n    }\n  };\n\n  const getcomments = () => {\n    const CancelToken = axios.CancelToken;\n    const source = CancelToken.source();\n    axios({\n      method: 'get',\n      url: servicePath.getArticleDetail + articleId + '/replies',\n      withCredentials: false,\n      cancelToken: source.token\n    }).then(res => {\n      source.cancel('方法被取消');\n      setIsLoading(false);\n      setComs(res.data.data);\n    }).catch(function (error) {\n      _message.error(error.status);\n    });\n  };\n\n  const login = useMemo(() => checkLogin(token), [token]);\n  useEffect(() => {\n    setToken(localStorage.getItem('token'));\n\n    if (isLoading) {\n      {\n        login;\n      }\n      getcomments();\n    }\n  }, []);\n\n  const loop = data => data.map(item => {\n    const index = item.all_children;\n    const content = index && index.length > 0 ? item.parent_id == 0 ? __jsx(\"div\", {\n      id: '#reply' + item.id\n    }, __jsx(_Comment, {\n      actions: [__jsx(ItemContext.Provider, {\n        value: item\n      }, __jsx(Star, {\n        auth: auth\n      })), __jsx(\"span\", {\n        key: \"comment-basic-reply-to\",\n        onClick: () => handleCommentClick(item)\n      }, __jsx(_Icon, {\n        type: \"message\"\n      }), \" \\u56DE\\u590D\")],\n      author: item.user.name,\n      avatar: item.user.avatar,\n      content: __jsx(ReactMarkdown, {\n        source: item.content,\n        escapeHtml: false\n      }),\n      datetime: item.created_at\n    }), item.id === parentId && __jsx(\"div\", {\n      style: {\n        width: '90%',\n        margin: '0 auto'\n      }\n    }, __jsx(ParentIdContext.Provider, {\n      value: {\n        parentId,\n        setParentId,\n        auth,\n        getcomments\n      }\n    }, __jsx(Editor, {\n      articleId: articleId\n    }))), loop(item.all_children)) : __jsx(\"div\", {\n      id: '#reply' + item.id,\n      style: {\n        width: '90%',\n        margin: '0 auto',\n        backgroundColor: '#f0f0f0',\n        paddingLeft: 10,\n        paddingRight: 10,\n        position: 'relative',\n        top: -15,\n        borderRadius: 4\n      }\n    }, __jsx(_Comment, {\n      actions: [__jsx(ItemContext.Provider, {\n        value: item\n      }, __jsx(Star, {\n        auth: auth\n      })), __jsx(\"span\", {\n        key: \"comment-basic-reply-to\",\n        onClick: () => handleCommentClick(item)\n      }, __jsx(_Icon, {\n        type: \"message\"\n      }), \" \\u56DE\\u590D\")],\n      author: item.user.name,\n      avatar: item.user.avatar,\n      content: __jsx(ReactMarkdown, {\n        source: item.content,\n        escapeHtml: false\n      }),\n      datetime: item.created_at\n    }), item.id === parentId && __jsx(\"div\", {\n      style: {\n        width: '90%',\n        margin: '0 auto'\n      }\n    }, __jsx(ParentIdContext.Provider, {\n      value: {\n        parentId,\n        setParentId,\n        auth,\n        getcomments\n      }\n    }, __jsx(Editor, {\n      articleId: articleId\n    }))), loop(item.all_children)) : item.parent_id == 0 ? __jsx(\"div\", {\n      id: '#reply' + item.id\n    }, __jsx(_Comment, {\n      actions: [__jsx(ItemContext.Provider, {\n        value: item\n      }, __jsx(Star, {\n        auth: auth\n      })), __jsx(\"span\", {\n        key: \"comment-basic-reply-to\",\n        onClick: () => handleCommentClick(item)\n      }, __jsx(_Icon, {\n        type: \"message\"\n      }), \" \\u56DE\\u590D\")],\n      author: item.user.name,\n      avatar: item.user.avatar,\n      content: __jsx(ReactMarkdown, {\n        source: item.content,\n        escapeHtml: false\n      }),\n      datetime: item.created_at\n    }), item.id === parentId && __jsx(\"div\", {\n      style: {\n        width: '90%',\n        margin: '0 auto'\n      }\n    }, __jsx(ParentIdContext.Provider, {\n      value: {\n        parentId,\n        setParentId,\n        auth,\n        getcomments\n      }\n    }, __jsx(Editor, {\n      articleId: articleId\n    })))) : __jsx(\"div\", {\n      id: '#reply' + item.id,\n      style: {\n        width: '90%',\n        backgroundColor: '#f0f0f0',\n        margin: '0 auto',\n        paddingLeft: 10,\n        paddingRight: 10,\n        position: 'relative',\n        top: -15,\n        borderRadius: 4\n      }\n    }, __jsx(_Comment, {\n      actions: [__jsx(ItemContext.Provider, {\n        value: item\n      }, __jsx(Star, {\n        auth: auth\n      })), __jsx(\"span\", {\n        key: \"comment-basic-reply-to\",\n        onClick: () => handleCommentClick(item)\n      }, __jsx(_Icon, {\n        type: \"message\"\n      }), \" \\u56DE\\u590D\")],\n      author: item.user.name,\n      avatar: item.user.avatar,\n      content: __jsx(ReactMarkdown, {\n        source: item.content,\n        escapeHtml: false\n      }),\n      datetime: item.created_at\n    }), item.id === parentId && __jsx(\"div\", {\n      style: {\n        width: '90%',\n        margin: '0 auto'\n      }\n    }, __jsx(ParentIdContext.Provider, {\n      value: {\n        parentId,\n        setParentId,\n        auth,\n        getcomments\n      }\n    }, __jsx(Editor, {\n      articleId: articleId\n    }))));\n    return __jsx(\"div\", {\n      key: item.id\n    }, content);\n  });\n\n  return __jsx(\"div\", null, __jsx(ParentIdContext.Provider, {\n    value: {\n      parentId,\n      setParentId,\n      auth,\n      getcomments\n    }\n  }, __jsx(Editor, {\n    articleId: articleId\n  })), loop(coms));\n};\n\nexport default Comments;","map":{"version":3,"sources":["/Users/mac/Desktop/liy-blog/components/Comments.jsx"],"names":["React","useState","useEffect","createContext","useMemo","Editor","ReactMarkdown","axios","Star","servicePath","ParentIdContext","ItemContext","Comments","articleId","token","setToken","parentId","setParentId","isLoading","setIsLoading","coms","setComs","auth","setAuth","handleCommentClick","comment","id","checkLogin","CancelToken","source","method","url","getUserInfo","headers","withCredentials","cancelToken","transformResponse","data","console","log","indexOf","JSON","parse","item","errors","error","localStorage","removeItem","then","res","cancel","eval","catch","getcomments","getArticleDetail","status","login","getItem","loop","map","index","all_children","content","length","parent_id","user","name","avatar","created_at","width","margin","backgroundColor","paddingLeft","paddingRight","position","top","borderRadius"],"mappings":"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","sourcesContent":["import React, { useState, useEffect, createContext, useMemo } from 'react'\nimport { message, Icon, Comment, List, Tooltip } from 'antd'\nimport Editor from './Editor'\nimport ReactMarkdown from 'react-markdown'\nimport axios from 'axios'\nimport Star from './Star'\nimport servicePath from '../config/apiUrl';\nexport const ParentIdContext = createContext({})\nexport const ItemContext = createContext()\n\nconst Comments = ({ articleId }) => {\n    const [token, setToken] = useState()\n    const [parentId, setParentId] = useState(0)\n    const [isLoading, setIsLoading] = useState(true)\n    const [coms, setComs] = useState([])\n    const [auth, setAuth] = useState()\n    const handleCommentClick = (comment) => {\n        if (comment.id === parentId) {\n            setParentId(0);\n            return;\n        }\n        setParentId(comment.id ? comment.id : 0);\n    };\n\n    const checkLogin = (token) => {\n        const CancelToken = axios.CancelToken;\n        const source = CancelToken.source();\n        if (token != null) {\n            axios({\n                method: 'get',\n                url: servicePath.getUserInfo,\n                headers: {\n                    'Authorization': 'Bearer ' + token,\n                },\n                withCredentials: false,\n                cancelToken: source.token,\n                transformResponse: function (data) {\n                    console.log(data)\n                    if (data.indexOf('errors') != -1) {\n                        data = JSON.parse(data);\n                        for (var item in data.errors) {\n                            message.error(data.errors[item][0]);\n                        }\n                    } else if (data.indexOf('Unauthenticated') != -1) {\n                        localStorage.removeItem('token')\n                        return data;\n                    } else {\n                        return data;\n                    }\n                }\n            }).then(\n                res => {\n                    source.cancel('方法被取消');\n                    setIsLoading(false)\n                    console.log(res);\n                    res.data = eval('(' + res.data + ')');\n                    console.log(res);\n                    setAuth(res.data.data);\n                }\n\n            ).catch(function (error) {\n                console.log(error)\n            });\n        } else {\n            console.log('asasdas1')\n        }\n    };\n\n\n\n    const getcomments = () => {\n        const CancelToken = axios.CancelToken;\n        const source = CancelToken.source();\n        axios({\n            method: 'get',\n            url: servicePath.getArticleDetail + articleId + '/replies',\n            withCredentials: false,\n            cancelToken: source.token,\n        }).then(\n            res => {\n                source.cancel('方法被取消');\n                setIsLoading(false);\n                setComs(res.data.data)\n            }\n        ).catch(function (error) {\n            message.error(error.status)\n        });\n    }\n\n    const login =useMemo(()=>checkLogin(token),[token])\n\n    useEffect(() => {\n        setToken(localStorage.getItem('token'))\n        if (isLoading) {\n            {login}\n            getcomments()\n        }\n    },[])\n\n\n    const loop = (data) => data.map((item) => {\n        const index = item.all_children;\n        const content = (index && index.length > 0) ? (\n            item.parent_id == 0 ? (\n                <div id={'#reply'+item.id}>\n                    <Comment\n                        actions={[<ItemContext.Provider value={item}><Star  auth={auth}/></ItemContext.Provider>, <span key=\"comment-basic-reply-to\" onClick={() => handleCommentClick(item)}><Icon type=\"message\" /> 回复</span>]}\n                        author={item.user.name}\n                        avatar={item.user.avatar}\n                        content={\n                            <ReactMarkdown\n                                source={item.content}\n                                escapeHtml={false}\n                            />\n                        }\n                        datetime={item.created_at}\n                    />\n                    {item.id === parentId && <div style={{ width: '90%', margin: '0 auto' }}>\n                        <ParentIdContext.Provider value={{ parentId, setParentId, auth,getcomments }}>\n                            <Editor articleId={articleId}/>\n                        </ParentIdContext.Provider>\n                    </div>}\n                    {loop(item.all_children)}\n                </div>) : (\n                    <div id={'#reply'+item.id} style={{ width: '90%', margin: '0 auto', backgroundColor: '#f0f0f0', paddingLeft: 10, paddingRight: 10, position: 'relative', top: -15, borderRadius: 4 }}>\n                        <Comment\n                            actions={[<ItemContext.Provider value={item}><Star  auth={auth}/></ItemContext.Provider>, <span key=\"comment-basic-reply-to\" onClick={() => handleCommentClick(item)}><Icon type=\"message\" /> 回复</span>]}\n                            author={item.user.name}\n                            avatar={item.user.avatar}\n                            content={\n                                <ReactMarkdown\n                                    source={item.content}\n                                    escapeHtml={false}\n                                />\n                            }\n                            datetime={item.created_at}\n                        />\n                        {item.id === parentId && <div style={{ width: '90%', margin: '0 auto' }}>\n                            <ParentIdContext.Provider value={{ parentId, setParentId, auth,getcomments }}>\n                                <Editor articleId={articleId}/>\n                            </ParentIdContext.Provider>\n                        </div>}\n                        {loop(item.all_children)}\n                    </div>\n                )\n        ) : (\n                item.parent_id == 0 ? (\n                    <div id={'#reply'+item.id}>\n                        <Comment\n                            actions={[<ItemContext.Provider value={item}><Star  auth={auth}/></ItemContext.Provider>, <span key=\"comment-basic-reply-to\" onClick={() => handleCommentClick(item)}><Icon type=\"message\" /> 回复</span>]}\n                            author={item.user.name}\n                            avatar={item.user.avatar}\n                            content={\n                                <ReactMarkdown\n                                    source={item.content}\n                                    escapeHtml={false}\n                                />\n                            }\n                            datetime={item.created_at}\n                        />\n                        {item.id === parentId && <div style={{ width: '90%', margin: '0 auto' }}>\n                            <ParentIdContext.Provider value={{ parentId, setParentId, auth, getcomments }}>\n                                <Editor articleId={articleId}/>\n                            </ParentIdContext.Provider>\n                        </div>}\n                    </div>\n                ) : (\n                        <div id={'#reply'+item.id} style={{ width: '90%',backgroundColor: '#f0f0f0', margin: '0 auto',paddingLeft: 10, paddingRight: 10, position: 'relative', top: -15, borderRadius: 4}}>\n                            <Comment\n                                actions={[<ItemContext.Provider value={item}><Star auth={auth}/></ItemContext.Provider>, <span key=\"comment-basic-reply-to\" onClick={() => handleCommentClick(item)}><Icon type=\"message\" /> 回复</span>]}\n                                author={item.user.name}\n                                avatar={item.user.avatar}\n                                content={\n                                    <ReactMarkdown\n                                        source={item.content}\n                                        escapeHtml={false}\n                                    />\n                                }\n                                datetime={item.created_at}\n                            />\n                            {item.id === parentId && <div style={{ width: '90%', margin: '0 auto' }}>\n                                <ParentIdContext.Provider value={{ parentId, setParentId, auth, getcomments }}>\n                                    <Editor articleId={articleId}/>\n                                </ParentIdContext.Provider>\n                            </div>}\n                        </div>)\n            );\n        return <div key={item.id} >{content}</div>;\n    });\n\n\n    return (\n        <div>\n            <ParentIdContext.Provider value={{ parentId, setParentId, auth, getcomments }}>\n                <Editor articleId={articleId} />\n            </ParentIdContext.Provider>\n            {loop(coms)}\n        </div>\n    )\n};\n\nexport default Comments"]},"metadata":{},"sourceType":"module"}