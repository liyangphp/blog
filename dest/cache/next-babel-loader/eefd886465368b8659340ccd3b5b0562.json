{"ast":null,"code":"import _classCallCheck from \"@babel/runtime-corejs2/helpers/esm/classCallCheck\";\nimport _createClass from \"@babel/runtime-corejs2/helpers/esm/createClass\";\nimport _defineProperty from \"@babel/runtime-corejs2/helpers/esm/defineProperty\";\nimport _Anchor from \"antd/lib/anchor\";\nvar __jsx = React.createElement;\nimport React from 'react';\nimport { last } from 'lodash';\nvar Link = _Anchor.Link;\n\n// TOC目录树结构\nvar Tocify =\n/*#__PURE__*/\nfunction () {\n  function Tocify() {\n    var _this = this;\n\n    _classCallCheck(this, Tocify);\n\n    _defineProperty(this, \"tocItems\", []);\n\n    _defineProperty(this, \"index\", 0);\n\n    _defineProperty(this, \"reset\", function () {\n      _this.tocItems = [];\n      _this.index = 0;\n    });\n\n    this.tocItems = [];\n    this.index = 0;\n  }\n\n  _createClass(Tocify, [{\n    key: \"add\",\n    value: function add(text, level) {\n      var anchor = \"toc\".concat(level).concat(++this.index);\n      var item = {\n        anchor: anchor,\n        level: level,\n        text: text\n      };\n      var items = this.tocItems;\n\n      if (items.length === 0) {\n        // 第一个 item 直接 push\n        items.push(item);\n      } else {\n        var lastItem = last(items); // 最后一个 item\n\n        if (item.level > lastItem.level) {\n          // item 是 lastItem 的 children\n          for (var i = lastItem.level + 1; i <= 2; i++) {\n            var _lastItem = lastItem,\n                children = _lastItem.children;\n\n            if (!children) {\n              // 如果 children 不存在\n              lastItem.children = [item];\n              break;\n            }\n\n            lastItem = last(children); // 重置 lastItem 为 children 的最后一个 item\n\n            if (item.level <= lastItem.level) {\n              // item level 小于或等于 lastItem level 都视为与 children 同级\n              children.push(item);\n              break;\n            }\n          }\n        } else {\n          // 置于最顶级\n          items.push(item);\n        }\n      }\n\n      return anchor;\n    }\n  }, {\n    key: \"renderToc\",\n    value: function renderToc(items) {\n      var _this2 = this;\n\n      // 递归 render\n      return items.map(function (item) {\n        return __jsx(Link, {\n          key: item.anchor,\n          href: \"#\".concat(item.anchor),\n          title: item.text\n        }, item.children && _this2.renderToc(item.children));\n      });\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      return __jsx(_Anchor, {\n        affix: true,\n        showInkInFixed: true\n      }, this.renderToc(this.tocItems));\n    }\n  }]);\n\n  return Tocify;\n}();\n\nexport { Tocify as default };","map":{"version":3,"sources":["/Users/mac/Desktop/liy-blog/components/tocify.tsx"],"names":["React","last","Link","Tocify","tocItems","index","text","level","anchor","item","items","length","push","lastItem","i","children","map","renderToc"],"mappings":";;;;;AAAA,OAAOA,KAAP,MAAkB,OAAlB;AAEA,SAASC,IAAT,QAAqB,QAArB;IAEQC,I,WAAAA,I;;AAS0B;IAEbC,M;;;AAKjB,oBAAc;AAAA;;AAAA;;AAAA,sCAJO,EAIP;;AAAA,mCAFE,CAEF;;AAAA,mCAsCN,YAAM;AACV,MAAA,KAAI,CAACC,QAAL,GAAgB,EAAhB;AACA,MAAA,KAAI,CAACC,KAAL,GAAa,CAAb;AACH,KAzCa;;AACV,SAAKD,QAAL,GAAgB,EAAhB;AACA,SAAKC,KAAL,GAAa,CAAb;AACH;;;;wBAEGC,I,EAAcC,K,EAAe;AAC7B,UAAMC,MAAM,gBAASD,KAAT,SAAiB,EAAE,KAAKF,KAAxB,CAAZ;AACA,UAAMI,IAAI,GAAG;AAAED,QAAAA,MAAM,EAANA,MAAF;AAAUD,QAAAA,KAAK,EAALA,KAAV;AAAiBD,QAAAA,IAAI,EAAJA;AAAjB,OAAb;AACA,UAAMI,KAAK,GAAG,KAAKN,QAAnB;;AAEA,UAAIM,KAAK,CAACC,MAAN,KAAiB,CAArB,EAAwB;AAAE;AACtBD,QAAAA,KAAK,CAACE,IAAN,CAAWH,IAAX;AACH,OAFD,MAEO;AACH,YAAII,QAAQ,GAAGZ,IAAI,CAACS,KAAD,CAAnB,CADG,CACoC;;AAEvC,YAAID,IAAI,CAACF,KAAL,GAAaM,QAAQ,CAACN,KAA1B,EAAiC;AAAE;AAC/B,eAAK,IAAIO,CAAC,GAAGD,QAAQ,CAACN,KAAT,GAAiB,CAA9B,EAAiCO,CAAC,IAAI,CAAtC,EAAyCA,CAAC,EAA1C,EAA8C;AAAA,4BACrBD,QADqB;AAAA,gBAClCE,QADkC,aAClCA,QADkC;;AAE1C,gBAAI,CAACA,QAAL,EAAe;AAAE;AACbF,cAAAA,QAAQ,CAACE,QAAT,GAAoB,CAACN,IAAD,CAApB;AACA;AACH;;AAEDI,YAAAA,QAAQ,GAAGZ,IAAI,CAACc,QAAD,CAAf,CAP0C,CAOJ;;AAEtC,gBAAIN,IAAI,CAACF,KAAL,IAAcM,QAAQ,CAACN,KAA3B,EAAkC;AAAE;AAChCQ,cAAAA,QAAQ,CAACH,IAAT,CAAcH,IAAd;AACA;AACH;AACJ;AACJ,SAfD,MAeO;AAAE;AACLC,UAAAA,KAAK,CAACE,IAAN,CAAWH,IAAX;AACH;AACJ;;AAED,aAAOD,MAAP;AACH;;;8BAOSE,K,EAAkB;AAAA;;AAAE;AAC1B,aAAOA,KAAK,CAACM,GAAN,CAAU,UAAAP,IAAI;AAAA,eACjB,MAAC,IAAD;AAAM,UAAA,GAAG,EAAEA,IAAI,CAACD,MAAhB;AAAwB,UAAA,IAAI,aAAMC,IAAI,CAACD,MAAX,CAA5B;AAAiD,UAAA,KAAK,EAAEC,IAAI,CAACH;AAA7D,WACKG,IAAI,CAACM,QAAL,IAAiB,MAAI,CAACE,SAAL,CAAeR,IAAI,CAACM,QAApB,CADtB,CADiB;AAAA,OAAd,CAAP;AAKH;;;6BAEQ;AACL,aACI;AAAQ,QAAA,KAAK,MAAb;AAAc,QAAA,cAAc;AAA5B,SACK,KAAKE,SAAL,CAAe,KAAKb,QAApB,CADL,CADJ;AAKH;;;;;;SA9DgBD,M","sourcesContent":["import React from 'react';\nimport { Anchor } from 'antd';\nimport { last } from 'lodash';\n\nconst { Link } = Anchor;\n\nexport interface TocItem {\n    anchor: string;\n    level: number;\n    text: string;\n    children?: TocItem[];\n}\n\nexport type TocItems = TocItem[]; // TOC目录树结构\n\nexport default class Tocify {\n    tocItems: TocItems = [];\n\n    index: number = 0;\n\n    constructor() {\n        this.tocItems = [];\n        this.index = 0;\n    }\n\n    add(text: string, level: number) {\n        const anchor = `toc${level}${++this.index}`;\n        const item = { anchor, level, text };\n        const items = this.tocItems;\n\n        if (items.length === 0) { // 第一个 item 直接 push\n            items.push(item);\n        } else {\n            let lastItem = last(items) as TocItem; // 最后一个 item\n\n            if (item.level > lastItem.level) { // item 是 lastItem 的 children\n                for (let i = lastItem.level + 1; i <= 2; i++) {\n                    const { children } = lastItem;\n                    if (!children) { // 如果 children 不存在\n                        lastItem.children = [item];\n                        break;\n                    }\n\n                    lastItem = last(children) as TocItem; // 重置 lastItem 为 children 的最后一个 item\n\n                    if (item.level <= lastItem.level) { // item level 小于或等于 lastItem level 都视为与 children 同级\n                        children.push(item);\n                        break;\n                    }\n                }\n            } else { // 置于最顶级\n                items.push(item);\n            }\n        }\n\n        return anchor;\n    }\n\n    reset = () => {\n        this.tocItems = [];\n        this.index = 0;\n    };\n\n    renderToc(items: TocItem[]) { // 递归 render\n        return items.map(item => (\n            <Link key={item.anchor} href={`#${item.anchor}`} title={item.text}>\n                {item.children && this.renderToc(item.children)}\n            </Link>\n        ));\n    }\n\n    render() {\n        return (\n            <Anchor affix showInkInFixed>\n                {this.renderToc(this.tocItems)}\n            </Anchor>\n        );\n    }\n}"]},"metadata":{},"sourceType":"module"}