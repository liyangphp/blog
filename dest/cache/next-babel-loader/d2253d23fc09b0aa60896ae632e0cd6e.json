{"ast":null,"code":"import _Promise from \"@babel/runtime-corejs2/core-js/promise\";\nimport _BackTop from \"antd/lib/back-top\";\nimport _Button from \"antd/lib/button\";\nimport _Row from \"antd/lib/row\";\nimport _Col from \"antd/lib/col\";\nimport _JSON$stringify from \"@babel/runtime-corejs2/core-js/json/stringify\";\nimport _message from \"antd/lib/message\";\nimport _Input from \"antd/lib/input\";\nimport _Select from \"antd/lib/select\";\nimport _Layout from \"antd/lib/layout\";\nvar __jsx = React.createElement;\n// import dynamic from 'next/dynamic'\n// const Createoredit = dynamic(\n//     import('../components/createoredit'),\n//     {\n//         ssr: false   //这个要加上,禁止使用 SSR\n//     }\n// )\n// export default () => <Createoredit />\nimport React, { useState, useEffect, createContext, useMemo } from 'react';\nimport marked from 'marked';\nimport axios from 'axios';\nimport \"easymde/dist/easymde.min.css\";\nimport Head from 'next/head';\nimport servicePath from '../config/apiUrl';\nimport Router from 'next/router';\nimport dynamic from 'next/dynamic';\nexport const FmtContext = createContext({});\nexport const ModelContext = createContext({});\nconst UploadImage = dynamic(() => import(\"../components/UploadImage\"), {\n  ssr: false //这个要加上,禁止使用 SSR\n  ,\n  loadableGenerated: {\n    webpack: () => [require.resolveWeak(\"../components/UploadImage\")],\n    modules: [\"../components/UploadImage\"]\n  }\n});\nconst SimpleMDE = dynamic(() => import(\"react-simplemde-editor\"), {\n  ssr: false //这个要加上,禁止使用 SSR\n  ,\n  loadableGenerated: {\n    webpack: () => [require.resolveWeak(\"react-simplemde-editor\")],\n    modules: [\"react-simplemde-editor\"]\n  }\n});\nconst Modals = dynamic(() => import(\"../components/Modals\"), {\n  ssr: false //这个要加上,禁止使用 SSR\n  ,\n  loadableGenerated: {\n    webpack: () => [require.resolveWeak(\"../components/Modals\")],\n    modules: [\"../components/Modals\"]\n  }\n});\nconst {\n  Content\n} = _Layout;\nconst Option = _Select.Option;\nconst {\n  TextArea\n} = _Input;\n\nconst Create = props => {\n  console.log('props', props);\n  const {\n    0: id,\n    1: setId\n  } = useState('');\n  const {\n    0: visible,\n    1: setVisible\n  } = useState(false);\n  const {\n    0: articleTitle,\n    1: setArticleTitle\n  } = useState(props.title ? props.title : '');\n  const {\n    0: introducemd,\n    1: setIntroducemd\n  } = useState(props.desc ? props.desc : '');\n  const {\n    0: introducehtml,\n    1: setIntroducehtml\n  } = useState(props.desc ? props.desc : '等待编辑');\n  const {\n    0: selectedType,\n    1: setSelectType\n  } = useState(props.category_id ? props.category_id : 1);\n  const {\n    0: options,\n    1: setOptions\n  } = useState([]);\n  const {\n    0: isLoading,\n    1: setIsLoading\n  } = useState(true);\n  const {\n    0: coin,\n    1: setCoin\n  } = useState(props.coin ? props.coin : '');\n  const {\n    0: baiduurl,\n    1: setBaiduurl\n  } = useState(props.baiduurl ? props.baiduurl : '');\n  const {\n    0: baidupwd,\n    1: setBaidupwd\n  } = useState(props.baidupwd ? props.baidupwd : '');\n  const {\n    0: count,\n    1: setCount\n  } = useState(props.count ? props.count : '');\n  const {\n    0: fmt,\n    1: setFmt\n  } = useState(props.fmt ? props.fmt : '');\n  const {\n    0: children,\n    1: setChildren\n  } = useState([]);\n  const {\n    0: zancun,\n    1: setZancun\n  } = useState(false);\n  const {\n    0: mdeValue,\n    1: setMdeValue\n  } = useState(props.content ? props.content : ''); //文章文章内容\n\n  const {\n    0: labValue,\n    1: setLabValue\n  } = useState(props.tags ? props.tags : []); //文章文章内容\n\n  const handleChange = value => {\n    setMdeValue(value);\n  };\n\n  const showModal = () => {\n    setVisible(true);\n  };\n\n  const getlabs = selectedType => {\n    const CancelToken = axios.CancelToken;\n    const source = CancelToken.source();\n    axios({\n      method: 'get',\n      url: servicePath.getLabs + '?id=' + selectedType,\n      cancelToken: source.token,\n      transformResponse: function (data) {\n        console.log(data);\n\n        if (data.indexOf('Unauthenticated') != -1) {\n          source.cancel('方法被取消');\n          window.location.href = '/';\n        } else {\n          return data;\n        }\n      }\n    }).then(res => {\n      setIsLoading(false);\n      res.data = eval('(' + res.data + ')');\n      source.cancel('方法被取消');\n      let labs = [];\n\n      for (let item in res.data.data) {\n        labs.push(__jsx(Option, {\n          key: item,\n          value: res.data.data[item].label\n        }, res.data.data[item].label));\n      }\n\n      setChildren(labs);\n    }).catch(function (error) {\n      console.log(error);\n    });\n  };\n\n  const stopSave = () => {\n    //localStorage.setItem('zancun', !zancun)\n    setZancun(!zancun);\n  };\n\n  const onSubmit = () => {\n    if (!articleTitle) {\n      _message.error('文章标题不能为空');\n\n      return false;\n    } else if (!introducehtml) {\n      _message.error('文章简介不能为空');\n\n      return false;\n    } else if (!selectedType) {\n      _message.error('文章类型不能为空');\n\n      return false;\n    }\n\n    if (_JSON$stringify(props) != \"{}\" && props.id) {\n      let values = labValue.join(',');\n      let dataProps = {\n        'id': props.id,\n        'title': articleTitle,\n        'desc': introducehtml,\n        'category_id': selectedType,\n        'content': mdeValue,\n        'coin': coin,\n        'fmt': fmt,\n        'user_id': localStorage.getItem('user_id'),\n        'biaoqian': values,\n        'baiduyu_url': baiduurl,\n        'baiduyu_pwd': baidupwd,\n        'count': count,\n        'status': localStorage.getItem('user_id') == 1 ? 1 : 0\n      };\n      axios({\n        method: 'patch',\n        url: servicePath.getArticleDetail + props.id,\n        data: dataProps,\n        headers: {\n          'Authorization': 'Bearer ' + localStorage.getItem('token')\n        },\n        transformResponse: function (data) {\n          if (data.indexOf('errors') != -1) {\n            data = JSON.parse(data);\n\n            for (var item in data.errors) {\n              _message.error(data.errors[item][0]);\n            }\n          } else if (data.indexOf('Unauthenticated') != -1) {\n            Router.push('/');\n          } else {\n            return data;\n          }\n        }\n      }).then(res => {\n        console.log(res);\n        Router.push('/');\n      }).catch(function (error) {\n        console.log(error);\n      });\n    } else {\n      let dataProps = {\n        'title': articleTitle,\n        'desc': introducehtml,\n        'category_id': selectedType,\n        'content': mdeValue,\n        'coin': coin,\n        'fmt': fmt,\n        'user_id': localStorage.getItem('user_id'),\n        'biaoqian': labValue,\n        'baiduyu_url': baiduurl,\n        'baiduyu_pwd': baidupwd,\n        'count': count,\n        'status': localStorage.getItem('user_id') == 1 ? 1 : 0\n      };\n      axios({\n        method: 'post',\n        url: servicePath.addArticle,\n        data: dataProps,\n        headers: {\n          'Authorization': 'Bearer ' + localStorage.getItem('token')\n        },\n        transformResponse: function (data) {\n          if (data.indexOf('errors') != -1) {\n            data = JSON.parse(data);\n\n            for (var item in data.errors) {\n              _message.error(data.errors[item][0]);\n            }\n          } else if (data.indexOf('Unauthenticated') != -1) {\n            Router.push('/');\n          } else {\n            return data;\n          }\n        }\n      }).then(res => {\n        console.log(res);\n        Router.push('/');\n      }).catch(function (error) {\n        console.log(error);\n      });\n    }\n  };\n\n  const getcategory = id => {\n    const CancelToken = axios.CancelToken;\n    const source = CancelToken.source();\n    axios({\n      method: 'get',\n      url: servicePath.getCategories,\n      cancelToken: source.token\n    }).then(res => {\n      source.cancel('方法被取消');\n      let options = [];\n\n      for (let i = 0; i < res.data.length; i++) {\n        options.push(__jsx(Option, {\n          key: res.data[i].id,\n          value: res.data[i].id.toString(36)\n        }, res.data[i].category_name));\n      }\n\n      setOptions(options);\n    }).catch(function (error) {\n      console.log(error);\n    });\n  };\n\n  function handleChange2(value) {\n    getlabs(value);\n    setSelectType(value);\n  }\n\n  marked.setOptions({\n    renderer: new marked.Renderer(),\n    gfm: true,\n    pedantic: false,\n    sanitize: false,\n    tables: true,\n    breaks: false,\n    smartLists: true,\n    smartypants: false\n  });\n\n  const handleChange1 = value => {\n    setLabValue(value);\n  };\n\n  const handleCancel = e => {\n    setVisible(false);\n  };\n\n  const changeIntroduce = e => {\n    setIntroducemd(e.target.value);\n    let html = marked(e.target.value);\n    setIntroducehtml(html);\n  };\n\n  const getlab = useMemo(() => getlabs(selectedType), [selectedType]);\n  const getcate = useMemo(() => getcategory(id), [id]);\n  useEffect(() => {\n    if (isLoading) {\n      {\n        getcate;\n      }\n      {\n        getlab;\n      }\n    }\n  }, []);\n  return __jsx(_Layout, {\n    className: \"ly\"\n  }, __jsx(Head, null, __jsx(\"title\", null, \"\\u535A\\u4EBA\\u5802 -- \\u7F16\\u8F91\\u6587\\u7AE0\")), __jsx(Content, {\n    className: \"content\"\n  }, __jsx(_Row, {\n    gutter: 5\n  }, __jsx(_Col, {\n    span: 18\n  }, __jsx(_Row, {\n    gutter: 10\n  }, __jsx(_Col, {\n    span: 20\n  }, __jsx(_Input, {\n    value: articleTitle,\n    onChange: e => {\n      setArticleTitle(e.target.value);\n    },\n    placeholder: \"\\u6807\\u9898\",\n    size: \"large\"\n  })), __jsx(_Col, {\n    span: 4\n  }, \"\\xA0\", __jsx(_Select, {\n    onChange: handleChange2,\n    defaultValue: selectedType + '',\n    size: \"large\"\n  }, options))), __jsx(\"br\", null), __jsx(_Row, {\n    gutter: 10\n  }, __jsx(_Col, {\n    span: 24\n  }, __jsx(SimpleMDE, {\n    options: {\n      autofocus: true,\n      autosave: {\n        enabled: zancun,\n        uniqueId: \"MyUniqueID\",\n        delay: 1000\n      },\n      toolbar: ['bold', 'italic', 'heading', \"code\", \"table\", \"clean-block\", 'quote', 'horizontal-rule', 'unordered-list', 'ordered-list', 'link', {\n        name: 'image',\n        action: () => {\n          showModal();\n        },\n        className: 'fa fa-file-image-o',\n        title: '上传'\n      }, 'preview', 'side-by-side', 'fullscreen'],\n      spellChecker: false\n    },\n    onChange: handleChange,\n    value: mdeValue\n  })))), __jsx(_Col, {\n    span: 6\n  }, __jsx(_Row, null, __jsx(_Col, {\n    span: 24\n  }, __jsx(_Button, {\n    type: zancun ? 'primary' : 'default',\n    size: \"large\",\n    onClick: stopSave\n  }, \"\\u6682\\u5B58\\u6587\\u7AE0\"), \"\\xA0\", __jsx(_Button, {\n    onClick: onSubmit,\n    type: \"primary\",\n    size: \"large\"\n  }, \"\\u53D1\\u5E03\"), __jsx(\"br\", null)), __jsx(_Col, {\n    span: 24\n  }, __jsx(\"br\", null), __jsx(TextArea, {\n    rows: 4,\n    style: {\n      height: 154\n    },\n    value: introducemd,\n    onChange: changeIntroduce,\n    onPressEnter: changeIntroduce,\n    placeholder: \"\\u7B80\\u4ECB\"\n  }), __jsx(\"br\", null), __jsx(\"br\", null), __jsx(\"div\", {\n    className: \"introduce-html\",\n    dangerouslySetInnerHTML: {\n      __html: '简介：' + introducehtml\n    }\n  })), __jsx(_Col, {\n    span: 24,\n    style: {\n      marginTop: '20px'\n    }\n  }, __jsx(FmtContext.Provider, {\n    value: {\n      fmt,\n      setFmt\n    }\n  }, __jsx(UploadImage, null)), fmt && __jsx(\"img\", {\n    src: fmt,\n    style: {\n      width: '100%',\n      marginTop: 10\n    }\n  })), __jsx(_Col, {\n    span: 24,\n    style: {\n      marginTop: '20px'\n    }\n  }, __jsx(_Select, {\n    mode: \"tags\",\n    type: {\n      isSelectOptGroup: false\n    },\n    style: {\n      width: '100%'\n    },\n    placeholder: \"\\u6807\\u7B7E\",\n    value: labValue,\n    onChange: handleChange1\n  }, children)), __jsx(_Col, {\n    span: 24,\n    style: {\n      marginTop: '20px'\n    }\n  }, __jsx(_Input, {\n    value: coin,\n    onChange: e => {\n      setCoin(e.target.value);\n    },\n    placeholder: \"\\u652F\\u4ED8\\u79EF\\u5206\"\n  })), __jsx(_Col, {\n    span: 17,\n    style: {\n      marginTop: '20px'\n    }\n  }, __jsx(_Input, {\n    value: baiduurl,\n    onChange: e => {\n      setBaiduurl(e.target.value);\n    },\n    placeholder: \"\\u767E\\u5EA6\\u4E91\\u76D8\\u7684\\u94FE\\u63A5\\u5730\\u5740\"\n  })), __jsx(_Col, {\n    span: 1,\n    style: {\n      marginTop: '20px'\n    }\n  }), __jsx(_Col, {\n    span: 6,\n    style: {\n      marginTop: '20px'\n    }\n  }, __jsx(_Input, {\n    value: baidupwd,\n    onChange: e => {\n      setBaidupwd(e.target.value);\n    },\n    placeholder: \"\\u5BC6\\u7801\"\n  })), __jsx(_Col, {\n    span: 24,\n    style: {\n      marginTop: '20px'\n    }\n  }, __jsx(_Input, {\n    value: count,\n    onChange: e => {\n      setCount(e.target.value);\n    },\n    placeholder: \"\\u8BFE\\u7A0B\\u6570/\\u8D44\\u6E90\\u5927\\u5C0F\"\n  })))))), __jsx(_BackTop, null), __jsx(ModelContext.Provider, {\n    value: {\n      visible,\n      setVisible,\n      mdeValue,\n      setMdeValue\n    }\n  }, __jsx(Modals, null)));\n};\n\nCreate.getInitialProps = async context => {\n  let id = context.ctx.query.id;\n  console.log('id', typeof id != \"undefined\");\n\n  if (_JSON$stringify(context.ctx.query) != \"{}\" && typeof id != \"undefined\") {\n    const promise = new _Promise(resolve => {\n      axios(servicePath.getArticleDetail + id).then(res => {\n        resolve(res.data.data);\n      });\n    });\n    return await promise;\n  } else {\n    return await new _Promise(resolve => {\n      resolve({});\n    });\n  }\n};\n\nexport default Create;","map":{"version":3,"sources":["/Users/mac/Desktop/liy-blog/pages/create.js"],"names":["React","useState","useEffect","createContext","useMemo","marked","axios","Head","servicePath","Router","dynamic","FmtContext","ModelContext","UploadImage","ssr","SimpleMDE","Modals","Content","Option","TextArea","Create","props","console","log","id","setId","visible","setVisible","articleTitle","setArticleTitle","title","introducemd","setIntroducemd","desc","introducehtml","setIntroducehtml","selectedType","setSelectType","category_id","options","setOptions","isLoading","setIsLoading","coin","setCoin","baiduurl","setBaiduurl","baidupwd","setBaidupwd","count","setCount","fmt","setFmt","children","setChildren","zancun","setZancun","mdeValue","setMdeValue","content","labValue","setLabValue","tags","handleChange","value","showModal","getlabs","CancelToken","source","method","url","getLabs","cancelToken","token","transformResponse","data","indexOf","cancel","window","location","href","then","res","eval","labs","item","push","label","catch","error","stopSave","onSubmit","values","join","dataProps","localStorage","getItem","getArticleDetail","headers","JSON","parse","errors","addArticle","getcategory","getCategories","i","length","toString","category_name","handleChange2","renderer","Renderer","gfm","pedantic","sanitize","tables","breaks","smartLists","smartypants","handleChange1","handleCancel","e","changeIntroduce","target","html","getlab","getcate","autofocus","autosave","enabled","uniqueId","delay","toolbar","name","action","className","spellChecker","height","__html","marginTop","width","isSelectOptGroup","getInitialProps","context","ctx","query","promise","resolve"],"mappings":"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","sourcesContent":["// import dynamic from 'next/dynamic'\n// const Createoredit = dynamic(\n//     import('../components/createoredit'),\n//     {\n//         ssr: false   //这个要加上,禁止使用 SSR\n//     }\n// )\n\n// export default () => <Createoredit />\n\nimport React, { useState, useEffect, createContext, useMemo } from 'react';\nimport marked from 'marked'\nimport axios from 'axios'\nimport \"easymde/dist/easymde.min.css\";\nimport { Layout, Row, Col, Input, Select, Button, Upload, Modal, Icon, message, BackTop } from 'antd'\nimport Head from 'next/head'\nimport servicePath from '../config/apiUrl';\nimport Router from 'next/router'\nimport dynamic from 'next/dynamic'\nexport const FmtContext = createContext({})\nexport const ModelContext = createContext({})\nconst UploadImage = dynamic(\n    import (\"../components/UploadImage\") ,\n    {\n      ssr: false   //这个要加上,禁止使用 SSR\n    }\n)\n\nconst SimpleMDE = dynamic(\n    import (\"react-simplemde-editor\") ,\n    {\n      ssr: false   //这个要加上,禁止使用 SSR\n    }\n)\n\n\nconst Modals = dynamic(\n    import (\"../components/Modals\") ,\n    {\n      ssr: false   //这个要加上,禁止使用 SSR\n    }\n)\n\nconst { Content } = Layout;\nconst Option = Select.Option;\nconst { TextArea } = Input\n\n\n\nconst Create = (props) => {\n    console.log('props',props)\n    const [id, setId]=useState('')\n    const [visible, setVisible] =useState(false)\n    const [articleTitle, setArticleTitle] = useState(props.title?props.title:'')\n    const [introducemd, setIntroducemd] = useState(props.desc?props.desc:'')\n    const [introducehtml, setIntroducehtml] = useState(props.desc?props.desc:'等待编辑')\n    const [selectedType, setSelectType] = useState(props.category_id?props.category_id:1)\n    const [options, setOptions] = useState([])\n    const [isLoading, setIsLoading] = useState(true)\n    const [coin, setCoin] = useState(props.coin?props.coin:'')\n    const [baiduurl, setBaiduurl] = useState(props.baiduurl?props.baiduurl:'')\n    const [baidupwd, setBaidupwd] = useState(props.baidupwd?props.baidupwd:'')\n    const [count, setCount] = useState(props.count?props.count:'')\n    const [fmt, setFmt] = useState(props.fmt?props.fmt:'')\n    const [children, setChildren] = useState([])\n    const [zancun, setZancun] = useState(false)\n    const [mdeValue, setMdeValue] = useState(props.content?props.content:'')//文章文章内容\n    const [labValue, setLabValue] = useState(props.tags?props.tags:[])//文章文章内容\n    const handleChange = value => {\n        setMdeValue(value)\n    };\n    const showModal = () => {\n        setVisible(true)\n    };\n\n    \n    const getlabs = (selectedType) => {\n        const CancelToken = axios.CancelToken;\n        const source = CancelToken.source();\n        axios({\n            method: 'get',\n            url: servicePath.getLabs+'?id='+selectedType,\n            cancelToken: source.token,\n            transformResponse:function(data){\n                console.log(data)\n                if(data.indexOf('Unauthenticated')!=-1){\n                    source.cancel('方法被取消');\n                    window.location.href='/'\n                }else{\n                    return data;\n                }\n            }\n        }).then(\n            res => {\n                setIsLoading(false)\n                res.data=eval('(' + res.data + ')');\n                source.cancel('方法被取消');\n                let labs=[];\n                for(let item in res.data.data){\n                    labs.push(<Option key={item} value={res.data.data[item].label}>{res.data.data[item].label}</Option>)\n                }\n\n                setChildren(labs)\n            }\n        ).catch(function (error) {\n            console.log(error)\n        });\n    }\n\n    \n\n    const stopSave = () => {\n        //localStorage.setItem('zancun', !zancun)\n        setZancun(!zancun)\n    }\n\n    const onSubmit = () => {\n        if (!articleTitle) {\n            message.error('文章标题不能为空')\n            return false\n        } else if (!introducehtml) {\n            message.error('文章简介不能为空')\n            return false\n        } else if (!selectedType) {\n            message.error('文章类型不能为空')\n            return false\n        }\n\n        if (JSON.stringify(props) != \"{}\"&&props.id) {\n            let values = labValue.join(',')\n            let dataProps = {\n                'id': props.id,\n                'title': articleTitle,\n                'desc': introducehtml,\n                'category_id': selectedType,\n                'content': mdeValue,\n                'coin': coin,\n                'fmt': fmt,\n                'user_id': localStorage.getItem('user_id'),\n                'biaoqian': values,\n                'baiduyu_url': baiduurl,\n                'baiduyu_pwd': baidupwd,\n                'count': count,\n                'status': localStorage.getItem('user_id') == 1 ? 1 : 0,\n            }\n\n            \n\n            axios({\n                method: 'patch',\n                url: servicePath.getArticleDetail + props.id,\n                data: dataProps,\n                headers: {\n                    'Authorization': 'Bearer ' + localStorage.getItem('token'),\n                }, transformResponse: function (data) {\n                    if (data.indexOf('errors') != -1) {\n                        data = JSON.parse(data);\n                        for (var item in data.errors) {\n                            message.error(data.errors[item][0]);\n                        }\n                    } else if (data.indexOf('Unauthenticated') != -1) {\n                        Router.push('/')\n                    } else {\n                        return data;\n                    }\n                }\n            }).then(\n                res => {\n                    console.log(res)\n                    Router.push('/')\n                }\n            ).catch(function (error) {\n                console.log(error)\n            });\n\n        } else {\n            let dataProps = {\n                'title': articleTitle,\n                'desc': introducehtml,\n                'category_id': selectedType,\n                'content': mdeValue,\n                'coin': coin,\n                'fmt': fmt,\n                'user_id': localStorage.getItem('user_id'),\n                'biaoqian': labValue,\n                'baiduyu_url': baiduurl,\n                'baiduyu_pwd': baidupwd,\n                'count': count,\n                'status': localStorage.getItem('user_id') == 1 ? 1 : 0,\n            }\n\n            axios({\n                method: 'post',\n                url: servicePath.addArticle,\n                data: dataProps,\n                headers: {\n                    'Authorization': 'Bearer ' + localStorage.getItem('token'),\n                }, transformResponse: function (data) {\n                    if (data.indexOf('errors') != -1) {\n                        data = JSON.parse(data);\n                        for (var item in data.errors) {\n                            message.error(data.errors[item][0]);\n                        }\n                    } else if (data.indexOf('Unauthenticated') != -1) {\n                        Router.push('/')\n                    } else {\n                        return data;\n                    }\n                }\n            }).then(\n                res => {\n                    console.log(res)\n                    Router.push('/')\n                }\n            ).catch(function (error) {\n                console.log(error)\n            });\n        }\n    }\n\n    const getcategory = (id) => {\n        const CancelToken = axios.CancelToken;\n        const source = CancelToken.source();\n        axios({\n            method: 'get',\n            url: servicePath.getCategories,\n            cancelToken: source.token,\n        }).then(\n            res => {\n                source.cancel('方法被取消');\n                let options = [];\n                for (let i = 0; i < res.data.length; i++) {\n                    options.push(<Option key={res.data[i].id} value={res.data[i].id.toString(36)}>{res.data[i].category_name}</Option>)\n                }\n                setOptions(options)\n            }\n        ).catch(function (error) {\n            console.log(error)\n        });\n    }\n\n    function handleChange2(value) {\n        getlabs(value)\n        setSelectType(value)\n    }\n\n\n\n    marked.setOptions({\n        renderer: new marked.Renderer(),\n        gfm: true,\n        pedantic: false,\n        sanitize: false,\n        tables: true,\n        breaks: false,\n        smartLists: true,\n        smartypants: false,\n    });\n\n\n\n    const handleChange1 = value => {\n        setLabValue(value)\n    }\n\n    \n    const handleCancel = e => {\n        setVisible(false)\n    };\n\n    const changeIntroduce = (e) => {\n        setIntroducemd(e.target.value)\n        let html = marked(e.target.value)\n        setIntroducehtml(html)\n    }\n\n    const getlab = useMemo(()=>getlabs(selectedType),[selectedType])\n    const getcate= useMemo(()=>getcategory(id),[id])\n    useEffect(() => {\n        if (isLoading) {\n            {getcate}\n            {getlab}\n        }\n    },[])\n\n\n\n    return (\n        <Layout className=\"ly\">\n            <Head>\n                <title>博人堂 -- 编辑文章</title>\n            </Head>\n            <Content className=\"content\">\n                <Row gutter={5}>\n                    <Col span={18}>\n                        <Row gutter={10} >\n                            <Col span={20}>\n                                <Input\n                                    value={articleTitle}\n                                    onChange={(e) => { setArticleTitle(e.target.value) }}\n                                    placeholder=\"标题\"\n                                    size=\"large\" />\n                            </Col>\n                            <Col span={4}>\n                                &nbsp;\n                                <Select\n                                    onChange={handleChange2}\n                                    defaultValue={selectedType + ''}\n                                    size=\"large\">\n                                    {options}\n                                </Select>\n                            </Col>\n                        </Row>\n                        <br />\n                        <Row gutter={10} >\n                            <Col span={24}>\n                                <SimpleMDE options={{\n                                    autofocus: true,\n                                    autosave: { enabled: zancun, uniqueId: \"MyUniqueID\", delay: 1000, },\n                                    toolbar: ['bold', 'italic', 'heading',\n                                        \"code\", \"table\", \"clean-block\", 'quote',\n                                        'horizontal-rule', 'unordered-list',\n                                        'ordered-list', 'link',\n                                        {\n                                            name: 'image',\n                                            action: () => {\n                                                showModal()\n                                            },\n                                            className: 'fa fa-file-image-o',\n                                            title: '上传',\n                                        }, 'preview',\n                                        'side-by-side', 'fullscreen'],\n                                    spellChecker: false\n                                }}\n                                    onChange={handleChange}\n                                    value={mdeValue}\n                                />\n                            </Col>\n                        </Row>\n\n                    </Col>\n\n                    <Col span={6}>\n                        <Row>\n                            <Col span={24}>\n                                <Button type={zancun ? 'primary' : 'default'} size=\"large\" onClick={stopSave}>暂存文章</Button>&nbsp;\n                                <Button onClick={onSubmit} type=\"primary\" size=\"large\" >发布</Button>\n                                <br />\n                            </Col>\n\n                            <Col span={24}>\n                                <br />\n                                <TextArea\n                                    rows={4}\n                                    style={{ height: 154 }}\n                                    value={introducemd}\n                                    onChange={changeIntroduce}\n                                    onPressEnter={changeIntroduce}\n                                    placeholder=\"简介\"\n                                />\n                                <br /><br />\n                                <div\n                                    className=\"introduce-html\"\n                                    dangerouslySetInnerHTML={{ __html: '简介：' + introducehtml }} >\n                                </div>\n                            </Col>\n\n                            <Col span={24} style={{ marginTop: '20px' }}>\n                                <FmtContext.Provider value={{fmt,setFmt}}>\n                                    <UploadImage/>\n                                </FmtContext.Provider>\n                                {fmt && <img src={fmt} style={{ width: '100%', marginTop: 10 }} />}\n                            </Col>\n\n                            <Col span={24} style={{ marginTop: '20px' }}>\n                                <Select\n                                    mode=\"tags\"\n                                    type={{ isSelectOptGroup: false }}\n                                    style={{ width: '100%' }}\n                                    placeholder=\"标签\"\n                                    value={labValue}\n                                    onChange={handleChange1}\n                                >\n                                    {children}\n                                </Select>\n                            </Col>\n\n                            <Col span={24} style={{ marginTop: '20px' }}>\n                                <Input\n                                    value={coin}\n                                    onChange={(e) => { setCoin(e.target.value) }}\n                                    placeholder=\"支付积分\" />\n                            </Col>\n\n                            <Col span={17} style={{ marginTop: '20px' }}>\n                                <Input\n                                    value={baiduurl}\n                                    onChange={(e) => { setBaiduurl(e.target.value) }}\n                                    placeholder=\"百度云盘的链接地址\" />\n                            </Col>\n\n                            <Col span={1} style={{ marginTop: '20px' }}>\n                            </Col>\n\n\n                            <Col span={6} style={{ marginTop: '20px' }}>\n                                <Input\n                                    value={baidupwd}\n                                    onChange={(e) => { setBaidupwd(e.target.value) }}\n                                    placeholder=\"密码\" />\n                            </Col>\n\n                            <Col span={24} style={{ marginTop: '20px' }}>\n                                <Input\n                                    value={count}\n                                    onChange={(e) => { setCount(e.target.value) }}\n                                    placeholder=\"课程数/资源大小\" />\n                            </Col>\n                        </Row>\n                    </Col>\n                </Row>\n            </Content>\n            <BackTop />\n            <ModelContext.Provider value = {{visible, setVisible, mdeValue, setMdeValue}}>\n                <Modals /> \n            </ModelContext.Provider>\n        </Layout>\n    )\n}\n\nCreate.getInitialProps = async (context) => {\n    let id = context.ctx.query.id\n    console.log('id', typeof id != \"undefined\")\n    if (JSON.stringify(context.ctx.query) != \"{}\" && typeof id != \"undefined\") {\n        const promise = new Promise((resolve) => {\n            axios(servicePath.getArticleDetail + id).then(\n                (res) => {\n                    resolve(res.data.data)\n                }\n            )\n        })\n        return await promise\n    }else{\n        return await new Promise(resolve => {\n            resolve({})\n        })\n    }\n}\n\nexport default Create"]},"metadata":{},"sourceType":"module"}