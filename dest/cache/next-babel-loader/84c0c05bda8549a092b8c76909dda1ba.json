{"ast":null,"code":"import _Comment from \"antd/lib/comment\";\nimport _Icon from \"antd/lib/icon\";\nimport _message from \"antd/lib/message\";\nvar __jsx = React.createElement;\nimport React, { useState, useEffect, createContext, useMemo } from 'react';\nimport Editor from './Editor';\nimport ReactMarkdown from 'react-markdown';\nimport Star from './Star';\nimport servicePath from '../config/apiUrl';\nexport var ParentIdContext = createContext({});\nexport var ItemContext = createContext();\n\nvar Comments = function Comments(_ref) {\n  var articleId = _ref.articleId;\n\n  var _useState = useState(),\n      token = _useState[0],\n      setToken = _useState[1];\n\n  var _useState2 = useState(0),\n      parentId = _useState2[0],\n      setParentId = _useState2[1];\n\n  var _useState3 = useState(true),\n      isLoading = _useState3[0],\n      setIsLoading = _useState3[1];\n\n  var _useState4 = useState([]),\n      coms = _useState4[0],\n      setComs = _useState4[1];\n\n  var _useState5 = useState(),\n      auth = _useState5[0],\n      setAuth = _useState5[1];\n\n  var handleCommentClick = function handleCommentClick(comment) {\n    if (comment.id === parentId) {\n      setParentId(0);\n      return;\n    }\n\n    setParentId(comment.id ? comment.id : 0);\n  };\n\n  var checkLogin = function checkLogin(token) {\n    var CancelToken = axios.CancelToken;\n    var source = CancelToken.source();\n\n    if (token != null) {\n      axios({\n        method: 'get',\n        url: servicePath.getUserInfo,\n        headers: {\n          'Authorization': 'Bearer ' + token\n        },\n        withCredentials: false,\n        cancelToken: source.token,\n        transformResponse: function transformResponse(data) {\n          console.log(data);\n\n          if (data.indexOf('errors') != -1) {\n            data = JSON.parse(data);\n\n            for (var item in data.errors) {\n              _message.error(data.errors[item][0]);\n            }\n          } else if (data.indexOf('Unauthenticated') != -1) {\n            localStorage.removeItem('token');\n            return data;\n          } else {\n            return data;\n          }\n        }\n      }).then(function (res) {\n        source.cancel('方法被取消');\n        setIsLoading(false);\n        console.log(res);\n        res.data = eval('(' + res.data + ')');\n        console.log(res);\n        setAuth(res.data.data);\n      })[\"catch\"](function (error) {\n        console.log(error);\n      });\n    } else {\n      console.log('asasdas1');\n    }\n  };\n\n  var getcomments = function getcomments() {\n    var CancelToken = axios.CancelToken;\n    var source = CancelToken.source();\n    axios({\n      method: 'get',\n      url: servicePath.getArticleDetail + articleId + '/replies',\n      withCredentials: true,\n      cancelToken: source.token\n    }).then(function (res) {\n      source.cancel('方法被取消');\n      setIsLoading(false);\n      setComs(res.data.data);\n    })[\"catch\"](function (error) {\n      _message.error(error.status);\n    });\n  };\n\n  var login = useMemo(function () {\n    return checkLogin(token);\n  }, [token]);\n  useEffect(function () {\n    setToken(localStorage.getItem('token'));\n\n    if (isLoading) {\n      {\n        login;\n      }\n      getcomments();\n    }\n  }, []);\n\n  var loop = function loop(data) {\n    return data.map(function (item) {\n      var index = item.all_children;\n      var content = index && index.length > 0 ? item.parent_id == 0 ? __jsx(\"div\", {\n        id: '#reply' + item.id\n      }, __jsx(_Comment, {\n        actions: [__jsx(ItemContext.Provider, {\n          value: item\n        }, __jsx(Star, {\n          auth: auth\n        })), __jsx(\"span\", {\n          key: \"comment-basic-reply-to\",\n          onClick: function onClick() {\n            return handleCommentClick(item);\n          }\n        }, __jsx(_Icon, {\n          type: \"message\"\n        }), \" \\u56DE\\u590D\")],\n        author: item.user.name,\n        avatar: item.user.avatar,\n        content: __jsx(ReactMarkdown, {\n          source: item.content,\n          escapeHtml: false\n        }),\n        datetime: item.created_at\n      }), item.id === parentId && __jsx(\"div\", {\n        style: {\n          width: '90%',\n          margin: '0 auto'\n        }\n      }, __jsx(ParentIdContext.Provider, {\n        value: {\n          parentId: parentId,\n          setParentId: setParentId,\n          auth: auth,\n          getcomments: getcomments\n        }\n      }, __jsx(Editor, {\n        articleId: articleId\n      }))), loop(item.all_children)) : __jsx(\"div\", {\n        id: '#reply' + item.id,\n        style: {\n          width: '90%',\n          margin: '0 auto',\n          backgroundColor: '#f0f0f0',\n          paddingLeft: 10,\n          paddingRight: 10,\n          position: 'relative',\n          top: -15,\n          borderRadius: 4\n        }\n      }, __jsx(_Comment, {\n        actions: [__jsx(ItemContext.Provider, {\n          value: item\n        }, __jsx(Star, {\n          auth: auth\n        })), __jsx(\"span\", {\n          key: \"comment-basic-reply-to\",\n          onClick: function onClick() {\n            return handleCommentClick(item);\n          }\n        }, __jsx(_Icon, {\n          type: \"message\"\n        }), \" \\u56DE\\u590D\")],\n        author: item.user.name,\n        avatar: item.user.avatar,\n        content: __jsx(ReactMarkdown, {\n          source: item.content,\n          escapeHtml: false\n        }),\n        datetime: item.created_at\n      }), item.id === parentId && __jsx(\"div\", {\n        style: {\n          width: '90%',\n          margin: '0 auto'\n        }\n      }, __jsx(ParentIdContext.Provider, {\n        value: {\n          parentId: parentId,\n          setParentId: setParentId,\n          auth: auth,\n          getcomments: getcomments\n        }\n      }, __jsx(Editor, {\n        articleId: articleId\n      }))), loop(item.all_children)) : item.parent_id == 0 ? __jsx(\"div\", {\n        id: '#reply' + item.id\n      }, __jsx(_Comment, {\n        actions: [__jsx(ItemContext.Provider, {\n          value: item\n        }, __jsx(Star, {\n          auth: auth\n        })), __jsx(\"span\", {\n          key: \"comment-basic-reply-to\",\n          onClick: function onClick() {\n            return handleCommentClick(item);\n          }\n        }, __jsx(_Icon, {\n          type: \"message\"\n        }), \" \\u56DE\\u590D\")],\n        author: item.user.name,\n        avatar: item.user.avatar,\n        content: __jsx(ReactMarkdown, {\n          source: item.content,\n          escapeHtml: false\n        }),\n        datetime: item.created_at\n      }), item.id === parentId && __jsx(\"div\", {\n        style: {\n          width: '90%',\n          margin: '0 auto'\n        }\n      }, __jsx(ParentIdContext.Provider, {\n        value: {\n          parentId: parentId,\n          setParentId: setParentId,\n          auth: auth,\n          getcomments: getcomments\n        }\n      }, __jsx(Editor, {\n        articleId: articleId\n      })))) : __jsx(\"div\", {\n        id: '#reply' + item.id,\n        style: {\n          width: '90%',\n          backgroundColor: '#f0f0f0',\n          margin: '0 auto',\n          paddingLeft: 10,\n          paddingRight: 10,\n          position: 'relative',\n          top: -15,\n          borderRadius: 4\n        }\n      }, __jsx(_Comment, {\n        actions: [__jsx(ItemContext.Provider, {\n          value: item\n        }, __jsx(Star, {\n          auth: auth\n        })), __jsx(\"span\", {\n          key: \"comment-basic-reply-to\",\n          onClick: function onClick() {\n            return handleCommentClick(item);\n          }\n        }, __jsx(_Icon, {\n          type: \"message\"\n        }), \" \\u56DE\\u590D\")],\n        author: item.user.name,\n        avatar: item.user.avatar,\n        content: __jsx(ReactMarkdown, {\n          source: item.content,\n          escapeHtml: false\n        }),\n        datetime: item.created_at\n      }), item.id === parentId && __jsx(\"div\", {\n        style: {\n          width: '90%',\n          margin: '0 auto'\n        }\n      }, __jsx(ParentIdContext.Provider, {\n        value: {\n          parentId: parentId,\n          setParentId: setParentId,\n          auth: auth,\n          getcomments: getcomments\n        }\n      }, __jsx(Editor, {\n        articleId: articleId\n      }))));\n      return __jsx(\"div\", {\n        key: item.id\n      }, content);\n    });\n  };\n\n  return __jsx(\"div\", null, __jsx(ParentIdContext.Provider, {\n    value: {\n      parentId: parentId,\n      setParentId: setParentId,\n      auth: auth,\n      getcomments: getcomments\n    }\n  }, __jsx(Editor, {\n    articleId: articleId\n  })), loop(coms));\n};\n\nexport default Comments;","map":{"version":3,"sources":["/Users/mac/Desktop/liy-blog/components/Comments.jsx"],"names":["React","useState","useEffect","createContext","useMemo","Editor","ReactMarkdown","Star","servicePath","ParentIdContext","ItemContext","Comments","articleId","token","setToken","parentId","setParentId","isLoading","setIsLoading","coms","setComs","auth","setAuth","handleCommentClick","comment","id","checkLogin","CancelToken","axios","source","method","url","getUserInfo","headers","withCredentials","cancelToken","transformResponse","data","console","log","indexOf","JSON","parse","item","errors","error","localStorage","removeItem","then","res","cancel","eval","getcomments","getArticleDetail","status","login","getItem","loop","map","index","all_children","content","length","parent_id","user","name","avatar","created_at","width","margin","backgroundColor","paddingLeft","paddingRight","position","top","borderRadius"],"mappings":"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","sourcesContent":["import React, { useState, useEffect, createContext, useMemo } from 'react'\nimport { message, Icon, Comment, List, Tooltip } from 'antd'\nimport Editor from './Editor'\nimport ReactMarkdown from 'react-markdown'\nimport Star from './Star'\nimport servicePath from '../config/apiUrl';\nexport const ParentIdContext = createContext({})\nexport const ItemContext = createContext()\n\nconst Comments = ({ articleId }) => {\n    const [token, setToken] = useState()\n    const [parentId, setParentId] = useState(0)\n    const [isLoading, setIsLoading] = useState(true)\n    const [coms, setComs] = useState([])\n    const [auth, setAuth] = useState()\n    const handleCommentClick = (comment) => {\n        if (comment.id === parentId) {\n            setParentId(0);\n            return;\n        }\n        setParentId(comment.id ? comment.id : 0);\n    };\n\n    const checkLogin = (token) => {\n        const CancelToken = axios.CancelToken;\n        const source = CancelToken.source();\n        if (token != null) {\n            axios({\n                method: 'get',\n                url: servicePath.getUserInfo,\n                headers: {\n                    'Authorization': 'Bearer ' + token,\n                },\n                withCredentials: false,\n                cancelToken: source.token,\n                transformResponse: function (data) {\n                    console.log(data)\n                    if (data.indexOf('errors') != -1) {\n                        data = JSON.parse(data);\n                        for (var item in data.errors) {\n                            message.error(data.errors[item][0]);\n                        }\n                    } else if (data.indexOf('Unauthenticated') != -1) {\n                        localStorage.removeItem('token')\n                        return data;\n                    } else {\n                        return data;\n                    }\n                }\n            }).then(\n                res => {\n                    source.cancel('方法被取消');\n                    setIsLoading(false)\n                    console.log(res);\n                    res.data = eval('(' + res.data + ')');\n                    console.log(res);\n                    setAuth(res.data.data);\n                }\n\n            ).catch(function (error) {\n                console.log(error)\n            });\n        } else {\n            console.log('asasdas1')\n        }\n    };\n\n\n\n    const getcomments = () => {\n        const CancelToken = axios.CancelToken;\n        const source = CancelToken.source();\n        axios({\n            method: 'get',\n            url: servicePath.getArticleDetail + articleId + '/replies',\n            withCredentials: true,\n            cancelToken: source.token,\n        }).then(\n            res => {\n                source.cancel('方法被取消');\n                setIsLoading(false);\n                setComs(res.data.data)\n            }\n        ).catch(function (error) {\n            message.error(error.status)\n        });\n    }\n\n    const login =useMemo(()=>checkLogin(token),[token])\n\n    useEffect(() => {\n        setToken(localStorage.getItem('token'))\n        if (isLoading) {\n            {login}\n            getcomments()\n        }\n    },[])\n\n\n    const loop = (data) => data.map((item) => {\n        const index = item.all_children;\n        const content = (index && index.length > 0) ? (\n            item.parent_id == 0 ? (\n                <div id={'#reply'+item.id}>\n                    <Comment\n                        actions={[<ItemContext.Provider value={item}><Star  auth={auth}/></ItemContext.Provider>, <span key=\"comment-basic-reply-to\" onClick={() => handleCommentClick(item)}><Icon type=\"message\" /> 回复</span>]}\n                        author={item.user.name}\n                        avatar={item.user.avatar}\n                        content={\n                            <ReactMarkdown\n                                source={item.content}\n                                escapeHtml={false}\n                            />\n                        }\n                        datetime={item.created_at}\n                    />\n                    {item.id === parentId && <div style={{ width: '90%', margin: '0 auto' }}>\n                        <ParentIdContext.Provider value={{ parentId, setParentId, auth,getcomments }}>\n                            <Editor articleId={articleId}/>\n                        </ParentIdContext.Provider>\n                    </div>}\n                    {loop(item.all_children)}\n                </div>) : (\n                    <div id={'#reply'+item.id} style={{ width: '90%', margin: '0 auto', backgroundColor: '#f0f0f0', paddingLeft: 10, paddingRight: 10, position: 'relative', top: -15, borderRadius: 4 }}>\n                        <Comment\n                            actions={[<ItemContext.Provider value={item}><Star  auth={auth}/></ItemContext.Provider>, <span key=\"comment-basic-reply-to\" onClick={() => handleCommentClick(item)}><Icon type=\"message\" /> 回复</span>]}\n                            author={item.user.name}\n                            avatar={item.user.avatar}\n                            content={\n                                <ReactMarkdown\n                                    source={item.content}\n                                    escapeHtml={false}\n                                />\n                            }\n                            datetime={item.created_at}\n                        />\n                        {item.id === parentId && <div style={{ width: '90%', margin: '0 auto' }}>\n                            <ParentIdContext.Provider value={{ parentId, setParentId, auth,getcomments }}>\n                                <Editor articleId={articleId}/>\n                            </ParentIdContext.Provider>\n                        </div>}\n                        {loop(item.all_children)}\n                    </div>\n                )\n        ) : (\n                item.parent_id == 0 ? (\n                    <div id={'#reply'+item.id}>\n                        <Comment\n                            actions={[<ItemContext.Provider value={item}><Star  auth={auth}/></ItemContext.Provider>, <span key=\"comment-basic-reply-to\" onClick={() => handleCommentClick(item)}><Icon type=\"message\" /> 回复</span>]}\n                            author={item.user.name}\n                            avatar={item.user.avatar}\n                            content={\n                                <ReactMarkdown\n                                    source={item.content}\n                                    escapeHtml={false}\n                                />\n                            }\n                            datetime={item.created_at}\n                        />\n                        {item.id === parentId && <div style={{ width: '90%', margin: '0 auto' }}>\n                            <ParentIdContext.Provider value={{ parentId, setParentId, auth, getcomments }}>\n                                <Editor articleId={articleId}/>\n                            </ParentIdContext.Provider>\n                        </div>}\n                    </div>\n                ) : (\n                        <div id={'#reply'+item.id} style={{ width: '90%',backgroundColor: '#f0f0f0', margin: '0 auto',paddingLeft: 10, paddingRight: 10, position: 'relative', top: -15, borderRadius: 4}}>\n                            <Comment\n                                actions={[<ItemContext.Provider value={item}><Star auth={auth}/></ItemContext.Provider>, <span key=\"comment-basic-reply-to\" onClick={() => handleCommentClick(item)}><Icon type=\"message\" /> 回复</span>]}\n                                author={item.user.name}\n                                avatar={item.user.avatar}\n                                content={\n                                    <ReactMarkdown\n                                        source={item.content}\n                                        escapeHtml={false}\n                                    />\n                                }\n                                datetime={item.created_at}\n                            />\n                            {item.id === parentId && <div style={{ width: '90%', margin: '0 auto' }}>\n                                <ParentIdContext.Provider value={{ parentId, setParentId, auth, getcomments }}>\n                                    <Editor articleId={articleId}/>\n                                </ParentIdContext.Provider>\n                            </div>}\n                        </div>)\n            );\n        return <div key={item.id} >{content}</div>;\n    });\n\n\n    return (\n        <div>\n            <ParentIdContext.Provider value={{ parentId, setParentId, auth, getcomments }}>\n                <Editor articleId={articleId} />\n            </ParentIdContext.Provider>\n            {loop(coms)}\n        </div>\n    )\n};\n\nexport default Comments"]},"metadata":{},"sourceType":"module"}