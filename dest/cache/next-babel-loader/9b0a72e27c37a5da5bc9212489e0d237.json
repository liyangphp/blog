{"ast":null,"code":"import _Modal from \"antd/lib/modal\";\nimport _Form from \"antd/lib/form\";\nimport _Input from \"antd/lib/input\";\nimport _List from \"antd/lib/list\";\nimport _message from \"antd/lib/message\";\nvar __jsx = React.createElement;\nimport React, { useEffect, useState } from 'react';\nimport axios from \"axios\";\n\nconst Security = () => {\n  const {\n    0: visiable,\n    1: setVisiable\n  } = useState(false);\n  const {\n    0: origin,\n    1: setOrigin\n  } = useState();\n  const {\n    0: pwd,\n    1: setPwd\n  } = useState();\n  const {\n    0: confirmPwd,\n    1: setConfirmPwd\n  } = useState();\n  const {\n    0: user,\n    1: setUser\n  } = useState();\n  const {\n    0: isLoading,\n    1: setIsLoading\n  } = useState(true); //获取会员数据\n\n  const checkLogin = () => {\n    const CancelToken = axios.CancelToken;\n    const source = CancelToken.source();\n\n    if (localStorage.getItem('token') != null) {\n      axios({\n        method: 'get',\n        url: '/api/v1/user',\n        headers: {\n          'Authorization': 'Bearer ' + localStorage.getItem('token')\n        },\n        withCredentials: false,\n        cancelToken: source.token,\n        transformResponse: function (data) {\n          if (data.indexOf('errors') != -1) {\n            data = JSON.parse(data);\n\n            for (var item in data.errors) {\n              _message.error(data.errors[item][0]);\n            }\n          } else if (data.indexOf('Unauthenticated') != -1) {\n            localStorage.removeItem('token');\n            return data;\n          } else {\n            return data;\n          }\n        }\n      }).then(res => {\n        source.cancel('方法被取消');\n        setIsLoading(false);\n        res.data = eval('(' + res.data + ')');\n        setUser(res.data.data);\n      }).catch(function (error) {\n        console.log(error);\n      });\n    } else {\n      console.log('asasdas3');\n    }\n  };\n\n  const getData = () => [{\n    title: '账户密码',\n    description: '修改密码需要提供原来的密码',\n    actions: [__jsx(\"a\", {\n      key: \"Modify\"\n    }, \"\\u4FEE\\u6539\")]\n  }];\n\n  const showModel = () => {\n    setVisiable(true);\n  };\n\n  useEffect(() => {\n    if (isLoading) {\n      checkLogin();\n    }\n  });\n  const data = getData();\n\n  const handleCancel = () => {\n    setVisiable(false);\n  };\n\n  const handleOk = () => {\n    let dataProps = {};\n    dataProps.origin = origin;\n    dataProps.pwd = pwd;\n    dataProps.confirm_pwd = confirmPwd;\n    dataProps.user_id = user.id;\n    axios({\n      method: 'post',\n      url: 'api/v1/user/repair',\n      headers: {\n        'Authorization': 'Bearer ' + localStorage.getItem('token')\n      },\n      data: dataProps\n    }).then(res => {\n      console.log(res);\n\n      _message.success(res.data.msg);\n\n      setVisiable(false);\n    });\n  };\n\n  return __jsx(\"div\", null, __jsx(_List, {\n    itemLayout: \"horizontal\",\n    dataSource: data,\n    renderItem: item => __jsx(_List.Item, {\n      actions: item.actions,\n      onClick: showModel\n    }, __jsx(_List.Item.Meta, {\n      title: item.title,\n      description: item.description\n    }))\n  }), __jsx(_Modal, {\n    title: \"\\u4FEE\\u6539\\u5BC6\\u7801\",\n    visible: visiable,\n    onOk: handleOk,\n    onCancel: handleCancel\n  }, __jsx(_Form, {\n    layout: \"vertical\",\n    hideRequiredMark: true\n  }, __jsx(_Form.Item, {\n    label: \"\\u539F\\u5BC6\\u7801\"\n  }, __jsx(_Input.Password, {\n    onChange: e => {\n      setOrigin(e.target.value);\n    },\n    value: origin,\n    placeholder: \"\\u8BF7\\u8F93\\u5165\\u539F\\u5BC6\\u7801\"\n  })), __jsx(_Form.Item, {\n    label: \"\\u65B0\\u5BC6\\u7801\"\n  }, __jsx(_Input.Password, {\n    onChange: e => {\n      setPwd(e.target.value);\n    },\n    value: pwd,\n    placeholder: \"\\u8BF7\\u8F93\\u5165\\u65B0\\u5BC6\\u7801,\\u5BC6\\u7801\\u4E0D\\u80FD\\u5E26\\u7279\\u6B8A\\u5B57\\u7B26\"\n  })), __jsx(_Form.Item, {\n    label: \"\\u786E\\u8BA4\\u5BC6\\u7801\"\n  }, __jsx(_Input.Password, {\n    onChange: e => {\n      setConfirmPwd(e.target.value);\n    },\n    value: confirmPwd,\n    placeholder: \"\\u8BF7\\u8F93\\u5165\\u786E\\u8BA4\\u5BC6\\u7801\"\n  })))));\n};\n\nexport default Security;","map":{"version":3,"sources":["/Users/mac/Desktop/liy-blog/components/Security.jsx"],"names":["React","useEffect","useState","axios","Security","visiable","setVisiable","origin","setOrigin","pwd","setPwd","confirmPwd","setConfirmPwd","user","setUser","isLoading","setIsLoading","checkLogin","CancelToken","source","localStorage","getItem","method","url","headers","withCredentials","cancelToken","token","transformResponse","data","indexOf","JSON","parse","item","errors","error","removeItem","then","res","cancel","eval","catch","console","log","getData","title","description","actions","showModel","handleCancel","handleOk","dataProps","confirm_pwd","user_id","id","success","msg","e","target","value"],"mappings":"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","sourcesContent":["import React, {useEffect, useState} from 'react';\n\nimport {Form, Icon, Input, List, Modal, message} from 'antd';\nimport axios from \"axios\";\n\nconst Security = () => {\n\n    const [visiable, setVisiable] = useState(false)\n    const [origin, setOrigin] = useState()\n    const [pwd, setPwd] = useState()\n    const [confirmPwd, setConfirmPwd] = useState()\n    const [user, setUser] = useState()\n    const [isLoading, setIsLoading] = useState(true)\n\n    //获取会员数据\n    const checkLogin = () => {\n        const CancelToken = axios.CancelToken;\n        const source = CancelToken.source();\n        if (localStorage.getItem('token') != null) {\n            axios({\n                method: 'get',\n                url: '/api/v1/user',\n                headers: {\n                    'Authorization': 'Bearer ' + localStorage.getItem('token'),\n                },\n                withCredentials: false,\n                cancelToken: source.token,\n                transformResponse: function (data) {\n                    if (data.indexOf('errors') != -1) {\n                        data = JSON.parse(data);\n                        for (var item in data.errors) {\n                            message.error(data.errors[item][0]);\n                        }\n                    } else if (data.indexOf('Unauthenticated') != -1) {\n                        localStorage.removeItem('token')\n                        return data;\n                    } else {\n                        return data;\n                    }\n                }\n            }).then(\n                res => {\n                    source.cancel('方法被取消');\n                    setIsLoading(false)\n                    res.data = eval('(' + res.data + ')');\n                    setUser(res.data.data);\n                }\n            ).catch(function (error) {\n                console.log(error)\n            });\n        } else {\n            console.log('asasdas3')\n        }\n    }\n\n    const getData = () => [\n        {\n            title: '账户密码',\n            description: '修改密码需要提供原来的密码',\n            actions: [\n                <a key=\"Modify\">\n                    修改\n                </a>,\n            ],\n        }\n    ];\n\n    const showModel = () =>{\n        setVisiable(true)\n    }\n\n    useEffect(() => {\n        if (isLoading) {\n            checkLogin()\n        }\n    })\n\n\n\n    const data = getData();\n\n    const handleCancel = () => {\n        setVisiable(false)\n    };\n\n    const handleOk = () =>{\n        let dataProps = {}\n        dataProps.origin = origin;\n        dataProps.pwd = pwd;\n        dataProps.confirm_pwd=confirmPwd\n        dataProps.user_id =user.id\n        axios({\n            method: 'post',\n            url: 'api/v1/user/repair',\n            headers: {\n                'Authorization': 'Bearer ' + localStorage.getItem('token'),\n            },\n            data:dataProps,\n        }).then(res => {\n            console.log(res)\n            message.success(res.data.msg)\n            setVisiable(false)\n        })\n    }\n\n    return (\n        <div>\n            <List\n                itemLayout=\"horizontal\"\n                dataSource={data}\n                renderItem={item => (\n                    <List.Item actions={item.actions} onClick={showModel}>\n                        <List.Item.Meta title={item.title} description={item.description}/>\n                    </List.Item>\n                )}\n            />\n\n            <Modal\n                title=\"修改密码\"\n                visible={visiable}\n                onOk={handleOk}\n                onCancel={handleCancel}>\n                <Form layout=\"vertical\" hideRequiredMark>\n                    <Form.Item label=\"原密码\">\n                        <Input.Password onChange={(e) => {\n                            setOrigin(e.target.value)\n                        }} value={origin} placeholder=\"请输入原密码\"/>\n                    </Form.Item>\n                    <Form.Item label=\"新密码\">\n                        <Input.Password onChange={(e) => {\n                            setPwd(e.target.value)\n                        }} value={pwd} placeholder=\"请输入新密码,密码不能带特殊字符\"/>\n                    </Form.Item>\n                    <Form.Item label=\"确认密码\">\n                        <Input.Password onChange={(e) => {\n                            setConfirmPwd(e.target.value)\n                        }} value={confirmPwd}  placeholder=\"请输入确认密码\"/>\n                    </Form.Item>\n                </Form>\n            </Modal>\n        </div>\n\n    );\n}\n\nexport default Security"]},"metadata":{},"sourceType":"module"}