{"version":3,"sources":["../src/dropdown.js"],"names":["DEFAULT_CLASS_NAME","Dropdown","el","document","createElement","style","display","position","zIndex","body","appendChild","options","shown","items","footer","header","maxCount","className","rotate","hasOwnProperty","placement","Object","keys","forEach","key","parentNode","removeChild","clear","_el","searchResults","cursorOffset","renderEvent","cancelable","emit","defaultPrevented","rawResults","map","searchResult","data","dropdownItems","slice","length","setStrategyId","renderEdge","append","setOffset","show","hide","dropdownItem","detail","selectEvent","deactivate","e","moveActiveItem","find","item","active","fragment","createDocumentFragment","push","appended","left","right","isPlacementTop","element","documentElement","bottom","clientHeight","top","lineHeight","showEvent","hideEvent","innerHTML","destroy","name","activeItem","getActiveItem","nextActiveItem","activate","preventDefault","strategyId","strategy","props","id","setAttribute","removeAttribute","type","source","content","li","classList","add"],"mappings":";;;;;;;;AACA;;;;AAEA;;;;AACA;;;;AACA;;;;;;;;;;AAGA,IAAMA,qBAAqB,qCAA3B;;AAEA;;AAWA;;;;;;IAMqBC,Q;;;;;oCAUsB;AACvC,UAAMC,KAAKC,SAASC,aAAT,CAAuB,IAAvB,CAAX;AACA,UAAMC,QAAQH,GAAGG,KAAjB;AACAA,YAAMC,OAAN,GAAgB,MAAhB;AACAD,YAAME,QAAN,GAAiB,UAAjB;AACAF,YAAMG,MAAN,GAAe,OAAf;AACA,UAAMC,OAAON,SAASM,IAAtB;AACA,UAAIA,IAAJ,EAAU;AACRA,aAAKC,WAAL,CAAiBR,EAAjB;AACD;AACD,aAAOA,EAAP;AACD;;;AAED,oBAAYS,OAAZ,EAAsC;AAAA;;AAAA;;AAEpC,UAAKC,KAAL,GAAa,KAAb;AACA,UAAKC,KAAL,GAAa,EAAb;AACA,UAAKC,MAAL,GAAcH,QAAQG,MAAtB;AACA,UAAKC,MAAL,GAAcJ,QAAQI,MAAtB;AACA,UAAKC,QAAL,GAAgBL,QAAQK,QAAR,IAAoB,EAApC;AACA,UAAKd,EAAL,CAAQe,SAAR,GAAoBN,QAAQM,SAAR,IAAqBjB,kBAAzC;AACA,UAAKkB,MAAL,GAAcP,QAAQQ,cAAR,CAAuB,QAAvB,IAAmCR,QAAQO,MAA3C,GAAoD,IAAlE;AACA,UAAKE,SAAL,GAAiBT,QAAQS,SAAzB;AACA,QAAMf,QAAQM,QAAQN,KAAtB;AACA,QAAIA,KAAJ,EAAW;AACTgB,aAAOC,IAAP,CAAYjB,KAAZ,EAAmBkB,OAAnB,CAA2B,UAACC,GAAD,EAAS;AACjC,cAAKtB,EAAL,CAAQG,KAAT,CAAqBmB,GAArB,IAA4BnB,MAAMmB,GAAN,CAA5B;AACD,OAFD;AAGD;AAfmC;AAgBrC;;AAED;;;;;;;8BAGU;AACR,UAAMC,aAAa,KAAKvB,EAAL,CAAQuB,UAA3B;AACA,UAAIA,UAAJ,EAAgB;AACdA,mBAAWC,WAAX,CAAuB,KAAKxB,EAA5B;AACD;AACD,WAAKyB,KAAL,GAAaC,GAAb,GAAmB,IAAnB;AACA,aAAO,IAAP;AACD;;;;;AASD;;;;;2BAKOC,a,EAA+BC,Y,EAA4B;AAChE,UAAMC,cAAc,8BAAkB,QAAlB,EAA4B,EAAEC,YAAY,IAAd,EAA5B,CAApB;AACA,WAAKC,IAAL,CAAU,QAAV,EAAoBF,WAApB;AACA,UAAIA,YAAYG,gBAAhB,EAAkC;AAChC,eAAO,IAAP;AACD;AACD,UAAMC,aAAaN,cAAcO,GAAd,CAAkB;AAAA,eAAgBC,aAAaC,IAA7B;AAAA,OAAlB,CAAnB;AACA,UAAMC,gBAAgBV,cACnBW,KADmB,CACb,CADa,EACV,KAAKxB,QAAL,IAAiBa,cAAcY,MADrB,EAEnBL,GAFmB,CAEf;AAAA,eAAgB,4BAAiBC,YAAjB,CAAhB;AAAA,OAFe,CAAtB;AAGA,WAAKV,KAAL,GACKe,aADL,CACmBb,cAAc,CAAd,CADnB,EAEKc,UAFL,CAEgBR,UAFhB,EAE4B,QAF5B,EAGKS,MAHL,CAGYL,aAHZ,EAIKI,UAJL,CAIgBR,UAJhB,EAI4B,QAJ5B,EAKKU,SALL,CAKef,YALf,EAMKgB,IANL;AAOA,WAAKb,IAAL,CAAU,UAAV,EAAsB,8BAAkB,UAAlB,CAAtB;AACA,aAAO,IAAP;AACD;;AAED;;;;;;;;iCAKa;AACX,aAAO,KAAKc,IAAL,GAAYpB,KAAZ,EAAP;AACD;;AAED;;;;;;2BAGOqB,Y,EAA4B;AACjC,UAAMC,SAAS,EAAEZ,cAAcW,aAAaX,YAA7B,EAAf;AACA,UAAMa,cAAc,8BAAkB,QAAlB,EAA4B,EAAElB,YAAY,IAAd,EAAoBiB,QAAQA,MAA5B,EAA5B,CAApB;AACA,WAAKhB,IAAL,CAAU,QAAV,EAAoBiB,WAApB;AACA,UAAIA,YAAYhB,gBAAhB,EAAkC;AAChC,eAAO,IAAP;AACD;AACD,WAAKiB,UAAL;AACA,WAAKlB,IAAL,CAAU,UAAV,EAAsB,8BAAkB,UAAlB,EAA8B,EAACgB,cAAD,EAA9B,CAAtB;AACA,aAAO,IAAP;AACD;;AAED;;;;;;uBAGGG,C,EAAgB;AACjB,aAAO,KAAKxC,KAAL,GAAa,KAAKyC,cAAL,CAAoB,MAApB,EAA4BD,CAA5B,CAAb,GAA8C,IAArD;AACD;;AAED;;;;;;yBAGKA,C,EAAgB;AACnB,aAAO,KAAKxC,KAAL,GAAa,KAAKyC,cAAL,CAAoB,MAApB,EAA4BD,CAA5B,CAAb,GAA8C,IAArD;AACD;;AAED;;;;;;oCAG+B;AAC7B,aAAO,KAAKvC,KAAL,CAAWyC,IAAX,CAAgB;AAAA,eAAQC,KAAKC,MAAb;AAAA,OAAhB,CAAP;AACD;;AAED;;;;;;;;2BAKO3C,K,EAAuB;AAAA;;AAC5B,UAAM4C,WAAWtD,SAASuD,sBAAT,EAAjB;AACA7C,YAAMU,OAAN,CAAc,gBAAQ;AACpB,eAAKV,KAAL,CAAW8C,IAAX,CAAgBJ,IAAhB;AACAA,aAAKK,QAAL;AACAH,iBAAS/C,WAAT,CAAqB6C,KAAKrD,EAA1B;AACD,OAJD;AAKA,WAAKA,EAAL,CAAQQ,WAAR,CAAoB+C,QAApB;AACA,aAAO,IAAP;AACD;;AAED;;;;8BACU3B,Y,EAA4B;AACpC,UAAIA,aAAa+B,IAAjB,EAAuB;AACrB,aAAK3D,EAAL,CAAQG,KAAR,CAAcwD,IAAd,GAAwB/B,aAAa+B,IAArC;AACD,OAFD,MAEO,IAAI/B,aAAagC,KAAjB,EAAwB;AAC7B,aAAK5D,EAAL,CAAQG,KAAR,CAAcyD,KAAd,GAAyBhC,aAAagC,KAAtC;AACD;AACD,UAAI,KAAKC,cAAL,EAAJ,EAA2B;AACzB,YAAMC,UAAU7D,SAAS8D,eAAzB;AACA,YAAID,OAAJ,EAAa;AACX,eAAK9D,EAAL,CAAQG,KAAR,CAAc6D,MAAd,GAA0BF,QAAQG,YAAR,GAAuBrC,aAAasC,GAApC,GAA0CtC,aAAauC,UAAjF;AACD;AACF,OALD,MAKO;AACL,aAAKnE,EAAL,CAAQG,KAAR,CAAc+D,GAAd,GAAuBtC,aAAasC,GAApC;AACD;AACD,aAAO,IAAP;AACD;;AAED;;;;;;;;2BAKO;AACL,UAAI,CAAC,KAAKxD,KAAV,EAAiB;AACf,YAAM0D,YAAY,8BAAkB,MAAlB,EAA0B,EAAEtC,YAAY,IAAd,EAA1B,CAAlB;AACA,aAAKC,IAAL,CAAU,MAAV,EAAkBqC,SAAlB;AACA,YAAIA,UAAUpC,gBAAd,EAAgC;AAC9B,iBAAO,IAAP;AACD;AACD,aAAKhC,EAAL,CAAQG,KAAR,CAAcC,OAAd,GAAwB,OAAxB;AACA,aAAKM,KAAL,GAAa,IAAb;AACA,aAAKqB,IAAL,CAAU,OAAV,EAAmB,8BAAkB,OAAlB,CAAnB;AACD;AACD,aAAO,IAAP;AACD;;AAED;;;;;;;;2BAKO;AACL,UAAI,KAAKrB,KAAT,EAAgB;AACd,YAAM2D,YAAY,8BAAkB,MAAlB,EAA0B,EAAEvC,YAAY,IAAd,EAA1B,CAAlB;AACA,aAAKC,IAAL,CAAU,MAAV,EAAkBsC,SAAlB;AACA,YAAIA,UAAUrC,gBAAd,EAAgC;AAC9B,iBAAO,IAAP;AACD;AACD,aAAKhC,EAAL,CAAQG,KAAR,CAAcC,OAAd,GAAwB,MAAxB;AACA,aAAKM,KAAL,GAAa,KAAb;AACA,aAAKqB,IAAL,CAAU,QAAV,EAAoB,8BAAkB,QAAlB,CAApB;AACD;AACD,aAAO,IAAP;AACD;;AAED;;;;;;;;4BAKQ;AACN,WAAK/B,EAAL,CAAQsE,SAAR,GAAoB,EAApB;AACA,WAAK3D,KAAL,CAAWU,OAAX,CAAmB;AAAA,eAAQgC,KAAKkB,OAAL,EAAR;AAAA,OAAnB;AACA,WAAK5D,KAAL,GAAa,EAAb;AACA,aAAO,IAAP;AACD;;AAED;;;;mCACe6D,I,EAAuBtB,C,EAAgB;AACpD,UAAMuB,aAAkB,KAAKC,aAAL,EAAxB;AACA,UAAIC,uBAAJ;AACA,UAAIF,UAAJ,EAAgB;AACdE,yBAAiBF,WAAWD,IAAX,CAAjB;AACD,OAFD,MAEO;AACLG,yBAAiBH,SAAS,MAAT,GAAkB,KAAK7D,KAAL,CAAW,CAAX,CAAlB,GAAkC,KAAKA,KAAL,CAAW,KAAKA,KAAL,CAAW4B,MAAX,GAAoB,CAA/B,CAAnD;AACD;AACD,UAAIoC,cAAJ,EAAoB;AAClBA,uBAAeC,QAAf;AACA1B,UAAE2B,cAAF;AACD;AACD,aAAO,IAAP;AACD;;AAED;;;;kCACc1C,Y,EAA6B;AACzC,UAAM2C,aAAa3C,gBAAgBA,aAAa4C,QAAb,CAAsBC,KAAtB,CAA4BC,EAA/D;AACA,UAAIH,UAAJ,EAAgB;AACd,aAAK9E,EAAL,CAAQkF,YAAR,CAAqB,eAArB,EAAsCJ,UAAtC;AACD,OAFD,MAEO;AACL,aAAK9E,EAAL,CAAQmF,eAAR,CAAwB,eAAxB;AACD;AACD,aAAO,IAAP;AACD;;AAED;;;;;;;+BAIWlD,U,EAAsBmD,I,EAA2B;AAC1D,UAAMC,SAAS,CAACD,SAAS,QAAT,GAAoB,KAAKvE,MAAzB,GAAkC,KAAKD,MAAxC,KAAmD,EAAlE;AACA,UAAM0E,UAAe,OAAOD,MAAP,KAAkB,UAAlB,GAA+BA,OAAOpD,UAAP,CAA/B,GAAoDoD,MAAzE;AACA,UAAME,KAAKtF,SAASC,aAAT,CAAuB,IAAvB,CAAX;AACAqF,SAAGC,SAAH,CAAaC,GAAb,mBAAiCL,IAAjC;AACAG,SAAGjB,SAAH,GAAegB,OAAf;AACA,WAAKtF,EAAL,CAAQQ,WAAR,CAAoB+E,EAApB;AACA,aAAO,IAAP;AACD;;AAED;;;;qCACiB;AACf,aAAO,KAAKrE,SAAL,KAAmB,KAA1B;AACD;;;wBA9M0B;AACzB,UAAI,CAAC,KAAKQ,GAAV,EAAe;AACb,aAAKA,GAAL,GAAW3B,SAASG,aAAT,EAAX;AACD;AACD,aAAO,KAAKwB,GAAZ;AACD;;;;;;kBA1DkB3B,Q","file":"dropdown.js","sourcesContent":["// @flow\nimport EventEmitter from 'eventemitter3';\n\nimport DropdownItem from './dropdown_item';\nimport SearchResult from './search_result';\nimport {createCustomEvent} from './utils';\nimport type {CursorOffset} from './editor';\n\nconst DEFAULT_CLASS_NAME = 'dropdown-menu textcomplete-dropdown';\n\n/** @typedef */\nexport type DropdownOptions = {\n  className?: string;\n  footer?: (any) => string | string;\n  header?: (any) => string | string;\n  maxCount?: number;\n  placement?: string;\n  rotate?: boolean;\n  style?: { [string]: string; };\n};\n\n/**\n * Encapsulate a dropdown view.\n *\n * @prop {boolean} shown - Whether the #el is shown or not.\n * @prop {DropdownItem[]} items - The array of rendered dropdown items.\n */\nexport default class Dropdown extends EventEmitter {\n  shown: boolean;\n  items: DropdownItem[];\n  footer: $PropertyType<DropdownOptions, 'footer'>;\n  header: $PropertyType<DropdownOptions, 'header'>;\n  maxCount: $PropertyType<DropdownOptions, 'maxCount'>;\n  rotate: $PropertyType<DropdownOptions, 'rotate'>;\n  placement: $PropertyType<DropdownOptions, 'placement'>;\n  _el: ?HTMLUListElement;\n\n  static createElement(): HTMLUListElement {\n    const el = document.createElement('ul');\n    const style = el.style;\n    style.display = 'none';\n    style.position = 'absolute';\n    style.zIndex = '10000';\n    const body = document.body;\n    if (body) {\n      body.appendChild(el);\n    }\n    return el;\n  }\n\n  constructor(options: DropdownOptions) {\n    super();\n    this.shown = false;\n    this.items = [];\n    this.footer = options.footer;\n    this.header = options.header;\n    this.maxCount = options.maxCount || 10;\n    this.el.className = options.className || DEFAULT_CLASS_NAME;\n    this.rotate = options.hasOwnProperty('rotate') ? options.rotate : true;\n    this.placement = options.placement;\n    const style = options.style;\n    if (style) {\n      Object.keys(style).forEach((key) => {\n        (this.el.style: any)[key] = style[key];\n      });\n    }\n  }\n\n  /**\n   * @return {this}\n   */\n  destroy() {\n    const parentNode = this.el.parentNode;\n    if (parentNode) {\n      parentNode.removeChild(this.el);\n    }\n    this.clear()._el = null;\n    return this;\n  }\n\n  get el(): HTMLUListElement {\n    if (!this._el) {\n      this._el = Dropdown.createElement();\n    }\n    return this._el;\n  }\n\n  /**\n   * Render the given data as dropdown items.\n   *\n   * @return {this}\n   */\n  render(searchResults: SearchResult[], cursorOffset: CursorOffset) {\n    const renderEvent = createCustomEvent('render', { cancelable: true });\n    this.emit('render', renderEvent);\n    if (renderEvent.defaultPrevented) {\n      return this;\n    }\n    const rawResults = searchResults.map(searchResult => searchResult.data);\n    const dropdownItems = searchResults\n      .slice(0, this.maxCount || searchResults.length)\n      .map(searchResult => new DropdownItem(searchResult));\n    this.clear()\n        .setStrategyId(searchResults[0])\n        .renderEdge(rawResults, 'header')\n        .append(dropdownItems)\n        .renderEdge(rawResults, 'footer')\n        .setOffset(cursorOffset)\n        .show();\n    this.emit('rendered', createCustomEvent('rendered'));\n    return this;\n  }\n\n  /**\n   * Hide the dropdown then sweep out items.\n   *\n   * @return {this}\n   */\n  deactivate() {\n    return this.hide().clear();\n  }\n\n  /**\n   * @return {this}\n   */\n  select(dropdownItem: DropdownItem) {\n    const detail = { searchResult: dropdownItem.searchResult };\n    const selectEvent = createCustomEvent('select', { cancelable: true, detail: detail });\n    this.emit('select', selectEvent);\n    if (selectEvent.defaultPrevented) {\n      return this;\n    }\n    this.deactivate();\n    this.emit('selected', createCustomEvent('selected', {detail}));\n    return this;\n  }\n\n  /**\n   * @return {this}\n   */\n  up(e: CustomEvent) {\n    return this.shown ? this.moveActiveItem('prev', e) : this;\n  }\n\n  /**\n   * @return {this}\n   */\n  down(e: CustomEvent) {\n    return this.shown ? this.moveActiveItem('next', e) : this;\n  }\n\n  /**\n   * Retrieve the active item.\n   */\n  getActiveItem(): ?DropdownItem {\n    return this.items.find(item => item.active);\n  }\n\n  /**\n   * Add items to dropdown.\n   *\n   * @private\n   */\n  append(items: DropdownItem[]) {\n    const fragment = document.createDocumentFragment();\n    items.forEach(item => {\n      this.items.push(item);\n      item.appended(this);\n      fragment.appendChild(item.el);\n    });\n    this.el.appendChild(fragment);\n    return this;\n  }\n\n  /** @private */\n  setOffset(cursorOffset: CursorOffset) {\n    if (cursorOffset.left) {\n      this.el.style.left = `${cursorOffset.left}px`;\n    } else if (cursorOffset.right) {\n      this.el.style.right = `${cursorOffset.right}px`;\n    }\n    if (this.isPlacementTop()) {\n      const element = document.documentElement;\n      if (element) {\n        this.el.style.bottom = `${element.clientHeight - cursorOffset.top + cursorOffset.lineHeight}px`;\n      }\n    } else {\n      this.el.style.top = `${cursorOffset.top}px`;\n    }\n    return this;\n  }\n\n  /**\n   * Show the element.\n   *\n   * @private\n   */\n  show() {\n    if (!this.shown) {\n      const showEvent = createCustomEvent('show', { cancelable: true });\n      this.emit('show', showEvent);\n      if (showEvent.defaultPrevented) {\n        return this;\n      }\n      this.el.style.display = 'block';\n      this.shown = true;\n      this.emit('shown', createCustomEvent('shown'));\n    }\n    return this;\n  }\n\n  /**\n   * Hide the element.\n   *\n   * @private\n   */\n  hide() {\n    if (this.shown) {\n      const hideEvent = createCustomEvent('hide', { cancelable: true });\n      this.emit('hide', hideEvent);\n      if (hideEvent.defaultPrevented) {\n        return this;\n      }\n      this.el.style.display = 'none';\n      this.shown = false;\n      this.emit('hidden', createCustomEvent('hidden'));\n    }\n    return this;\n  }\n\n  /**\n   * Clear search results.\n   *\n   * @private\n   */\n  clear() {\n    this.el.innerHTML = '';\n    this.items.forEach(item => item.destroy());\n    this.items = [];\n    return this;\n  }\n\n  /** @private */\n  moveActiveItem(name: 'next' | 'prev', e: CustomEvent) {\n    const activeItem: any = this.getActiveItem();\n    let nextActiveItem;\n    if (activeItem) {\n      nextActiveItem = activeItem[name];\n    } else {\n      nextActiveItem = name === 'next' ? this.items[0] : this.items[this.items.length - 1];\n    }\n    if (nextActiveItem) {\n      nextActiveItem.activate();\n      e.preventDefault();\n    }\n    return this;\n  }\n\n  /** @private */\n  setStrategyId(searchResult: ?SearchResult) {\n    const strategyId = searchResult && searchResult.strategy.props.id;\n    if (strategyId) {\n      this.el.setAttribute('data-strategy', strategyId);\n    } else {\n      this.el.removeAttribute('data-strategy');\n    }\n    return this;\n  }\n\n  /**\n   * @private\n   * @param {object[]} rawResults - What callbacked by search function.\n   */\n  renderEdge(rawResults: Object[], type: 'header' | 'footer') {\n    const source = (type === 'header' ? this.header : this.footer) || '';\n    const content: any = typeof source === 'function' ? source(rawResults) : source;\n    const li = document.createElement('li');\n    li.classList.add(`textcomplete-${type}`);\n    li.innerHTML = content;\n    this.el.appendChild(li);\n    return this;\n  }\n\n  /** @private */\n  isPlacementTop() {\n    return this.placement === 'top';\n  }\n}\n"]}