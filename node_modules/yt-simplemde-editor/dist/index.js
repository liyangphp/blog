module.exports=function(o){var r={};function i(e){if(r[e])return r[e].exports;var t=r[e]={i:e,l:!1,exports:{}};return o[e].call(t.exports,t,t.exports,i),t.l=!0,t.exports}return i.m=o,i.c=r,i.d=function(e,t,o){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var o=Object.create(null);if(i.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)i.d(o,r,function(e){return t[e]}.bind(null,r));return o},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="",i(i.s=20)}([function(e,t){e.exports=require("lodash")},function(e,t,o){"use strict";o.d(t,"a",function(){return r}),o.d(t,"b",function(){return i}),o.d(t,"c",function(){return n});var a=o(0);function r(i){var n={people:1e5,nature:2e5,food:3e5,activity:4e5,travel:5e5,objects:6e5,symbols:7e5,flags:8e5},s=[];return Object.keys(i).sort(function(e,t){var o=Object(a.get)(n,i[e].category,0)+Object(a.get)(i[e],"order",0),r=Object(a.get)(n,i[t].category,0)+Object(a.get)(i[t],"order",0);return o<r?-1:o===r?0:1}).forEach(function(e){try{var t=i[e],o=t.shortname,r=o.replace(/:/g,"");if(!Object(a.get)(n,t.category,0))return;if("modifier"===t.category)return;"regional"===t.category&&(t.category="symbols");if([].includes(o))return;t._key=e,t.keywords.push(t.name),t.keywords.includes(r)||t.keywords.push(r),s.push(t)}catch(e){}}),s}function i(e){for(var t=e.offsetLeft,o=e.offsetTop+e.scrollTop,r=e.offsetParent;null!==r;)t+=r.offsetLeft,o+=r.offsetTop,r=r.offsetParent;return{left:t,top:o}}function n(t,e){for(var o=Array.isArray(e)?e:[e];"BODY"!==t.tagName.toUpperCase();){if(o.some(function(e){return t==e}))return!0;t=t.parentNode}return!1}},function(e,t){e.exports=require("react")},function(e,t){e.exports=require("react-dom")},function(e,t){e.exports=require("simplemde")},,,,,,,function(e,t){e.exports=require("simplemde/dist/simplemde.min.css")},function(e,t){e.exports=require("yt-emoji-picker/dist/style.css")},function(e,t,o){},,,,,,,function(e,t,o){"use strict";o.r(t);var r=o(2),d=o.n(r),i=o(3),f=o.n(i),n=o(4),h=o.n(n),y=o(0);function c(e){return(c="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function s(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function v(e){var t=e.responseText||e.response;if(!t)return t;try{return JSON.parse(t)}catch(e){return t}}var a=function(){function o(e,t){var a=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,o),this.onPaste=function(e){var t=e.clipboardData;if(t&&"object"===c(t)){for(var o=t.items||t.files||[],r=[],i=0;i<o.length;i++){var n=o[i];if(n instanceof DataTransferItem){var s=n.getAsFile();"string"!==n.kind&&s&&r.push(s)}else r.push(n)}0<r.length&&e.preventDefault(),a.uploadFiles(r)}},this.onDrop=function(e,t){t.preventDefault();var o=t.dataTransfer.files;a.uploadFiles(o)},this.codemirror=e,this.options=Object.assign({},o.defaultOptions,t),this.addEvents()}return function(e,t,o){t&&s(e.prototype,t),o&&s(e,o)}(o,[{key:"uploadFiles",value:function(i){for(var n=this,e=function(e){var t=i[e];if(n.isFileAllowed(t)){var o=n.options.beforeUpload;if(!o)return n.insertProgressText(),n.upload(t),"continue";var r=o(t);r instanceof Promise?r.then(function(){n.insertProgressText(),n.upload(t)}):!1!==r&&(n.insertProgressText(),n.upload(t))}},t=0;t<i.length;t++)e(t)}},{key:"upload",value:function(t){var e=this,o=new FormData,r=new XMLHttpRequest,i=this.options,n=i.action,s=i.name,a=i.headers,c=i.withCredentials,u=i.onError,l=this.options.data;for(var p in"function"==typeof l&&(l=l(t)),l&&Object.keys(l).map(function(e){o.append(e,l[e])}),o.append(s,t),r.onerror=function(e){u&&u(e,null,t)},r.onload=function(){if(200===r.status||201===r.status)return e.onUploadSuccess(r,t);e.onUploadError(r,t)},r.open("post",n,!0),c&&"withCredentials"in r&&(r.withCredentials=!0),r.setRequestHeader("X-Requested-With","XMLHttpRequest"),a)a.hasOwnProperty(p)&&r.setRequestHeader(p,a[p]);r.send(o)}},{key:"insertProgressText",value:function(){var e=this.options.progressText;this.lastValue=e,this.codemirror.replaceSelection(this.lastValue)}},{key:"isFileAllowed",value:function(e){var t=this.options.allowedTypes;return function t(e,o){return!!e&&(Array.isArray(e)?e.some(function(e){return t(e,o)}):e===o||new RegExp("^".concat(e.replace("*",".*"))).test(o))}(void 0===t?"*":t,e.type)}},{key:"onUploadSuccess",value:function(e,t){var o=this.codemirror,r=this.options,i=r.jsonName,n=r.progressText,s=r.onSuccess,a=this.lastValue,c=v(e),u=Object(y.get)(c,i),l="![file](".concat(u,")"),p=o.getCursor(),m=o.getValue().replace(a,l);o.setValue(m),p.ch+=l.length-n.length,o.setCursor(p),o.focus(),s&&s(c,t)}},{key:"onUploadError",value:function(e,t){var o=this.codemirror,r=this.options.onError,i=this.lastValue,n=o.getCursor(),s=o.getValue().replace(i,"");o.setValue(s),o.setCursor(n),o.focus(),r&&r(function(e,t){var o="cannot post ".concat(e.action," ").concat(t.status),r=new Error(o);return r.status=t.status,r}(this.options,e),v(e),t)}},{key:"removeEvents",value:function(){this.codemirror.getWrapperElement().removeEventListener("paste",this.onPaste,!1),this.codemirror.off("drop",this.onDrop)}},{key:"addEvents",value:function(){this.codemirror.getWrapperElement().addEventListener("paste",this.onPaste,!1),this.codemirror.on("drop",this.onDrop)}},{key:"destroy",value:function(){this.removeEvents()}}]),o}();a.defaultOptions={action:"",name:"file",jsonName:"fileUrl",allowedTypes:"image/*",progressText:"![Uploading file...]()",data:{},headers:{},withCredentials:!1};var u=o(1);o(11),o(12),o(13);function l(e){return(l="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function p(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function b(e,t){return!t||"object"!==l(t)&&"function"!=typeof t?function(e){if(void 0!==e)return e;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(e):t}function g(e){return(g=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function m(e,t){return(m=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var j=function(){function t(e){var m;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(m=b(this,g(t).call(this,e))).state={contentChanged:!1},m.id="",m.wrapperId="",m.handleChange=function(e,t){m.simplemde&&m.triggerChange(m.simplemde.value())},m.handleEmojiSelect=function(e,t){if(m.simplemde&&m.props.emoji&&m.props.emojiToolkit){var o="unicode"===m.props.emoji.insertConvertTo?m.props.emojiToolkit.shortnameToUnicode(e.shortname):e.shortname;m.simplemde.codemirror.replaceSelection(o)}},m.hiddenEmojiPickerPopup=function(e){m.emojiPickerPopup&&"none"!==m.emojiPickerPopup.style.display&&(Object(u.c)(e.target,m.emojiPickerPopup)||"fa fa-smile-o"===e.target.className&&"emoji"===e.target.title||(m.emojiPickerPopup.style.display="none"))},m.triggerChange=function(e){var t=m.props.onChange;t&&(m.setState({contentChanged:!0}),t(e))},m.getMdeInstance=function(){var e=m.props.getMdeInstance;e&&m.simplemde&&e(m.simplemde)},m.addExtraKeys=function(){var e=m.props.extraKeys;e&&m.simplemde&&m.simplemde.codemirror.setOption("extraKeys",e)},m.removeEvents=function(){m.simplemde&&m.simplemde.codemirror.off("change",m.handleChange)},m.addEvents=function(){m.simplemde&&m.simplemde.codemirror.on("change",m.handleChange)},m.createEditor=function(){var e=m.props,t=e.value,o=e.options,r=void 0===o?{}:o,i=e.emoji,n=e.EmojiPicker,s=e.emojiToolkit;if(i&&i.enabled&&Array.isArray(r.toolbar)&&r.toolbar.includes("emoji"))if(n&&s){r.toolbar=r.toolbar.map(function(e){return"emoji"===e?{name:"emoji",action:function(e){m.toggleEmojiPickerPopup(e.toolbarElements.emoji)},className:"fa fa-smile-o",title:"emoji"}:e}),m.emojiPickerPopup=document.createElement("div"),m.emojiPickerPopup.id="emoji-picker-popup",m.emojiPickerPopup.style.display="none",m.emojiPickerPopup.style.position="absolute",m.emojiPickerPopup.style.zIndex="99999",document.body.addEventListener("click",m.hiddenEmojiPickerPopup,!1),document.body.appendChild(m.emojiPickerPopup);var a={emojiToolkit:i.emojiToolkit,onSelect:m.handleEmojiSelect,search:!0,recentCount:36,rowHeight:40};f.a.render(d.a.createElement(n,a),m.emojiPickerPopup)}else console.error("使用emojiPicker必须提供EmojiPicker和emojiToolkit属性，基本用法详见：https://github.com/yanthink/react-simplemde-editor/blob/master/demo/src/pages/index.js");var c=Object.assign({},r,{element:document.getElementById(m.id),initialValue:t}),u=new h.a(c),l=r.autosave;if(l&&!0===l.enabled&&l.uniqueId){var p=u.value();p&&p!==t&&m.triggerChange(p)}return u},m.id=m.props.id||"simplemde-editor-".concat(Date.now()),m.wrapperId="".concat(m.id,"-wrapper"),m}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&m(e,t)}(t,d.a.Component),function(e,t,o){t&&p(e.prototype,t),o&&p(e,o)}(t,[{key:"componentDidMount",value:function(){if("undefined"!=typeof window){this.simplemde=this.createEditor(),this.addEvents(),this.addExtraKeys(),this.getMdeInstance();var e=this.props,t=e.uploadOptions,o=e.emoji;t&&(this.upload=new a(this.simplemde.codemirror,t)),o&&o.enabled&&o.autoComplete&&this.initAutoCompleteEmoji()}}},{key:"componentWillReceiveProps",value:function(e){if(this.simplemde){var t=this.state.contentChanged,o=e.value;t||void 0===o||o===this.simplemde.value()||this.simplemde.value(o),this.setState({contentChanged:!1})}}},{key:"componentWillUnmount",value:function(){this.upload&&this.upload.destroy(),this.textcomplete&&this.textcomplete.destroy(),this.simplemde&&(this.simplemde.isFullscreenActive()&&this.simplemde.toggleFullScreen(),this.simplemde.autosaveTimeoutId&&clearTimeout(this.simplemde.autosaveTimeoutId)),this.emojiPickerPopup&&(document.body.removeEventListener("click",this.hiddenEmojiPickerPopup,!1),document.body.removeChild(this.emojiPickerPopup)),this.removeEvents()}},{key:"toggleEmojiPickerPopup",value:function(e){if(this.emojiPickerPopup)if("none"===this.emojiPickerPopup.style.display){this.emojiPickerPopup.style.visibility="hidden",this.emojiPickerPopup.style.display="block";var t=Object(u.b)(e),o=t.top+44,r=t.left-1;r+this.emojiPickerPopup.scrollWidth>document.body.scrollWidth&&(r=document.body.scrollWidth-this.emojiPickerPopup.scrollWidth-20),this.emojiPickerPopup.style.top="".concat(o,"px"),this.emojiPickerPopup.style.left="".concat(r,"px"),this.emojiPickerPopup.style.visibility="visible"}else this.emojiPickerPopup.style.display="none"}},{key:"initAutoCompleteEmoji",value:function(){var e=this.props,r=e.emoji,i=e.emojiToolkit,n=e.emojiData,t=e.Textcomplete,o=e.CodemirrorEditor,s=e.escape;if(this.simplemde&&r&&r.autoComplete){if(!(i&&n&&t&&o&&s))return void console.error("开启emoji自动补全必须提供emojiToolkit、emojiData、Textcomplete、CodemirrorEditor和escape属性，基本用法详见：https://github.com/yanthink/react-simplemde-editor/blob/master/demo/src/pages/index.js");this.textcomplete=new t(new o(this.simplemde.codemirror),{dropdown:{className:"emoji-dropdown-menu",maxCount:5}}),this.textcomplete.register([{match:/(\B):([\-+\w]*)$/,search:function(e,t){var o=0<arguments.length&&void 0!==e?e:"";(1<arguments.length?t:void 0)(n.filter(function(e){var t=new RegExp("^(?:.* +)*".concat(s(o)),"i");return e.keywords.some(function(e){return t.test(e)})}))},replace:function(e){return"unicode"===r.insertConvertTo?i.shortnameToUnicode(e.shortname):e.shortname},template:function(e){var o={};Object(y.each)(r.emojiToolkit,function(e,t){o[t]=i[t],i[t]=e});var t="".concat(i.toImage(e.shortname)," ").concat(e.shortname.replace(/:/g,""));return Object(y.each)(o,function(e,t){i[t]=e}),t}}])}}},{key:"render",value:function(){var e=this.props,t=e.className,o=e.label;return d.a.createElement("div",{id:this.wrapperId,className:t},o&&d.a.createElement("label",{htmlFor:this.id},o),d.a.createElement("textarea",{id:this.id}))}}]),t}();t.default=j}]);